<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: control_system::UpdateControlSystem&lt; ControlSystem &gt; Struct Template Reference</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('structcontrol__system_1_1UpdateControlSystem.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="structcontrol__system_1_1UpdateControlSystem-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">control_system::UpdateControlSystem&lt; ControlSystem &gt; Struct Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Functor for updating control systems when they are ready.  
 <a href="structcontrol__system_1_1UpdateControlSystem.html#details">More...</a></p>

<p><code>#include &lt;UpdateControlSystem.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:afae6c68262173377c5de9400533b4826"><td class="memTemplParams" colspan="2"><a id="afae6c68262173377c5de9400533b4826" name="afae6c68262173377c5de9400533b4826"></a>
template&lt;typename DbTags , typename Metavariables , typename ArrayIndex , typename... TupleTags&gt; </td></tr>
<tr class="memitem:afae6c68262173377c5de9400533b4826"><td class="memTemplItemLeft" align="right" valign="top">static void&#160;</td><td class="memTemplItemRight" valign="bottom"><b>apply</b> (const <a class="el" href="classgsl_1_1not__null.html">gsl::not_null</a>&lt; db::DataBox&lt; DbTags &gt; * &gt; box, <a class="el" href="classParallel_1_1GlobalCache.html">Parallel::GlobalCache</a>&lt; Metavariables &gt; &amp;cache, const ArrayIndex &amp;, const double time, <a class="el" href="classtuples_1_1TaggedTuple.html">tuples::TaggedTuple</a>&lt; TupleTags... &gt; data)</td></tr>
<tr class="separator:afae6c68262173377c5de9400533b4826"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:af7f84149b647a712b18d633fc3aae644"><td class="memItemLeft" align="right" valign="top"><a id="af7f84149b647a712b18d633fc3aae644" name="af7f84149b647a712b18d633fc3aae644"></a>
static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><b>deriv_order</b> = ControlSystem::deriv_order</td></tr>
<tr class="separator:af7f84149b647a712b18d633fc3aae644"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename ControlSystem&gt;<br />
struct control_system::UpdateControlSystem&lt; ControlSystem &gt;</div><p >Functor for updating control systems when they are ready. </p>
<h3>Details</h3>
<p >The apply operator of this struct is meant to be called by the UpdateMessageQueue action once an entire measurement has been made.</p>
<p >Requires a few tags to be in the DataBox of the <a class="el" href="structControlComponent.html" title="The singleton parallel component responsible for managing a single control system.">ControlComponent</a> that this is running on:</p><ul>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1Averager.html">Averager </a></li>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1Controller.html">Controller </a></li>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1TimescaleTuner.html">TimescaleTuner </a></li>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1ControlError.html">ControlError </a></li>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1WriteDataToDisk.html">WriteDataToDisk </a></li>
<li><a class="el" href="structcontrol__system_1_1Tags_1_1CurrentNumberOfMeasurements.html">CurrentNumberOfMeasurements </a></li>
</ul>
<p >And the <a class="el" href="structcontrol__system_1_1Tags_1_1MeasurementsPerUpdate.html">control_system::Tags::MeasurementsPerUpdate</a> must be in the GlobalCache. If these tags are not present, a build error will occur.</p>
<p >The algorithm to determine whether or not to update the functions of time is as follows:</p><ol type="1">
<li>Ensure this control system is active. If it isn't, end here and don't process the measurements.</li>
<li>Increment the current measurement stored by <code><a class="el" href="structcontrol__system_1_1Tags_1_1CurrentNumberOfMeasurements.html" title="DataBox tag that keeps track of which measurement we are on.">control_system::Tags::CurrentNumberOfMeasurements</a></code>. This keeps track of which measurement we are on out of <code><a class="el" href="structcontrol__system_1_1Tags_1_1MeasurementsPerUpdate.html" title="Tag that determines how many measurements will occur per control system update. This will usually be ...">control_system::Tags::MeasurementsPerUpdate</a></code>.</li>
<li>Calculate the control error and update the averager (store the current measurement). If the averager doesn't have enough information to determine the derivatives of the control error, exit now (this usually only happens for the first couple measurements of a simulation).</li>
<li>If the <code><a class="el" href="structcontrol__system_1_1Tags_1_1WriteDataToDisk.html" title="DataBox tag for writing control system data to disk.">control_system::Tags::WriteDataToDisk</a></code> tag is set to <code>true</code>, write the time, function of time values, and the control error and its derivative to disk.</li>
<li>Determine if we need to update. We only want to update when the current measurement is equal to the number of measurements per update. If it's not time to update, exit now. Once we determine that it is time to update, set the current measurement back to 0.</li>
<li>Update the damping timescales in the <a class="el" href="classTimescaleTuner.html" title="Manages control system timescales.">TimescaleTuner</a> and compute the control signal using the control error and its derivatives.</li>
<li>Calculate the new measurement timescale based off the updated damping timescales and the number of measurements per update.</li>
<li>Determine the new expiration times for the <code><a class="el" href="structdomain_1_1Tags_1_1FunctionsOfTime.html" title="Tag to retrieve the FunctionsOfTime from the GlobalCache.">domain::Tags::FunctionsOfTime</a></code> and <code><a class="el" href="structcontrol__system_1_1Tags_1_1MeasurementTimescales.html" title="The measurement timescales associated with domain::Tags::FunctionsOfTime.">control_system::Tags::MeasurementTimescales</a></code>. Update the MaxDeriv of the functions of time with the control signal and update the measurement timescales with the new measurement timescale (both of these are <code><a class="el" href="group__ParallelGroup.html#ga8fb8fc6f30581c450abecc8258dead3c" title="Mutates non-const data in the cache, by calling Function::apply()">Parallel::mutate</a></code> calls). </li>
</ol>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>src/ControlSystem/UpdateControlSystem.hpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacecontrol__system.html">control_system</a></li><li class="navelem"><a class="el" href="structcontrol__system_1_1UpdateControlSystem.html">UpdateControlSystem</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
