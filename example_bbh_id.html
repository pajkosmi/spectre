<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: Binary black hole initial data</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('example_bbh_id.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Binary black hole initial data </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__work_build_docs_tmp_notebooks_md_BbhInitialData"></a> In this example we run the elliptic solver to compute initial data for binary black holes.</p>
<div class="fragment"><div class="line"><span class="comment"># Distributed under the MIT License.</span></div>
<div class="line"><span class="comment"># See LICENSE.txt for details.</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Dependencies:</span></div>
<div class="line">%pip install numpy matplotlib pandas <span class="stringliteral">&#39;h5py&gt;=3.0.0&#39;</span> ruamel.yaml</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">import</span> h5py</div>
<div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div>
<div class="line"><span class="keyword">import</span> multiprocessing</div>
<div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><span class="keyword">import</span> os</div>
<div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><span class="keyword">from</span> ruamel.yaml <span class="keyword">import</span> YAML</div>
<div class="line"> </div>
<div class="line">plt.style.use(<span class="stringliteral">&quot;../plots.mplstyle&quot;</span>)</div>
</div><!-- fragment --><div class="fragment"><div class="line">%%bash</div>
<div class="line"># Clean up output files from previous runs</div>
<div class="line">rm -f Bbh*.h5</div>
</div><!-- fragment --><p >First, make sure you have compiled the <code>SolveXcts</code> executable. Put in the path to your build directory below. Make sure you have compiled in <code>Release</code> mode.</p>
<div class="fragment"><div class="line">SPECTRE_BUILD_DIR = <span class="stringliteral">&quot;/Users/nlf/Work/spectre/build-Default-Release&quot;</span></div>
<div class="line">SPECTRE_HOME = <span class="stringliteral">&quot;/Users/nlf/Projects/spectre/develop&quot;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md192"></a>
Setup input file</h1>
<p >We set up an input file based on the <code>tests/InputFiles/Xcts/BinaryBlackHole.yaml</code> example:</p>
<div class="fragment"><div class="line"><span class="comment"># Load example input file</span></div>
<div class="line">load_input_file_path = os.path.join(</div>
<div class="line">    SPECTRE_HOME, <span class="stringliteral">&quot;tests/InputFiles/Xcts/BinaryBlackHole.yaml&quot;</span></div>
<div class="line">)</div>
<div class="line">yaml = YAML()</div>
<div class="line"><span class="keyword">with</span> open(load_input_file_path, <span class="stringliteral">&quot;r&quot;</span>) <span class="keyword">as</span> open_input_file:</div>
<div class="line">    input_file = yaml.load(open_input_file)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Modify example input file</span></div>
<div class="line"><span class="comment"># - Set output file names</span></div>
<div class="line">input_file[<span class="stringliteral">&quot;Observers&quot;</span>][<span class="stringliteral">&quot;VolumeFileName&quot;</span>] = <span class="stringliteral">&quot;BbhVolume&quot;</span></div>
<div class="line">input_file[<span class="stringliteral">&quot;Observers&quot;</span>][<span class="stringliteral">&quot;ReductionFileName&quot;</span>] = <span class="stringliteral">&quot;BbhReductions&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Write modified input file</span></div>
<div class="line"><span class="keyword">with</span> open(<span class="stringliteral">&quot;Bbh.yaml&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>) <span class="keyword">as</span> open_input_file:</div>
<div class="line">    yaml.dump(input_file, open_input_file)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md193"></a>
Run executable</h1>
<p >We pass the input file to the <code>SolveXcts</code> executable to solve the elliptic problem. It will take a few minutes to complete on ~10 cores. Adapt the command below to your system, or run the <code>SolveXcts</code> executable with the <code>Bbh.yaml</code> input file manually.</p>
<div class="fragment"><div class="line">NUM_CORES = multiprocessing.cpu_count()</div>
<div class="line">SOLVE_XCTS = os.path.join(SPECTRE_BUILD_DIR, <span class="stringliteral">&quot;bin/SolveXcts&quot;</span>)</div>
<div class="line">!{SOLVE_XCTS} --input-file Bbh.yaml +p {NUM_CORES}</div>
</div><!-- fragment --> <pre class="fragment">Charm++: standalone mode (not using charmrun)
Charm++&gt; Running in Multicore mode: 12 threads (PEs)
Converse/Charm++ Commit ID: v6.10.2-0-g7bf00fa
Warning&gt; Randomization of virtual memory (ASLR) is turned on in the kernel, thread migration may not work! Run 'echo 0 &gt; /proc/sys/kernel/randomize_va_space' as root to disable it, or try running with '+isomalloc_sync'.
CharmLB&gt; Load balancer assumes all CPUs are same.
Charm++&gt; Running on 1 hosts (12 sockets x 1 cores x 1 PUs = 12-way SMP)
Charm++&gt; cpu topology info is gathered in 0.002 seconds.

Executing '/Users/nlf/Work/spectre/build-Default-Release/bin/SolveXcts' using 12 processors.
Charm++ startup time in seconds: 3.621687
Date and time at startup: Tue Feb 22 15:08:18 2022

SpECTRE Build Information:
Version:                      2022.02.17
Compiled on host:             98c21919c2ac
Compiled in directory:        /Users/nlf/Work/spectre/build-Default-Release
Source directory is:          /Users/nlf/Projects/spectre/develop
Compiled on git branch:       xcts_input_files
Compiled on git revision:     db7100f700b
Linked on:                    Thu Jan 27 17:45:20 2022

The following options differ from their suggested values:

Option parsing completed.
Multigrid level 0 has 232 elements in 54 blocks distributed on 12 procs.
Multigrid level 1 has 54 elements in 54 blocks distributed on 12 procs.
NewtonRaphson initialized with residual: 1.058476e+01
Gmres initialized with residual: 1.058476e+01
Gmres(1) iteration complete. Remaining residual: 2.003738e-01
Gmres(2) iteration complete. Remaining residual: 1.206809e-01
Gmres(3) iteration complete. Remaining residual: 8.694367e-02
Gmres(4) iteration complete. Remaining residual: 7.275577e-02
Gmres(5) iteration complete. Remaining residual: 4.520779e-02
Gmres(6) iteration complete. Remaining residual: 1.464362e-02
Gmres(7) iteration complete. Remaining residual: 6.754772e-03
Gmres has converged in 7 iterations: RelativeResidual - The residual magnitude has decreased to a fraction of 0.001 of its initial value or below (0.00063816).
NewtonRaphson(1) iteration complete (0 globalization steps, step length 1). Remaining residual: 2.865222e+00
Gmres initialized with residual: 2.865222e+00
Gmres(1) iteration complete. Remaining residual: 4.062729e-02
Gmres(2) iteration complete. Remaining residual: 2.455538e-02
Gmres(3) iteration complete. Remaining residual: 1.602018e-02
Gmres(4) iteration complete. Remaining residual: 1.181106e-02
Gmres(5) iteration complete. Remaining residual: 5.591212e-03
Gmres(6) iteration complete. Remaining residual: 2.012421e-03
Gmres has converged in 6 iterations: RelativeResidual - The residual magnitude has decreased to a fraction of 0.001 of its initial value or below (0.000702361).
NewtonRaphson(2) iteration complete (0 globalization steps, step length 1). Remaining residual: 8.164886e-03
Gmres initialized with residual: 8.164886e-03
Gmres(1) iteration complete. Remaining residual: 1.279278e-03
Gmres(2) iteration complete. Remaining residual: 7.680224e-04
Gmres(3) iteration complete. Remaining residual: 6.026001e-04
Gmres(4) iteration complete. Remaining residual: 5.116235e-04
Gmres(5) iteration complete. Remaining residual: 3.771227e-04
Gmres(6) iteration complete. Remaining residual: 1.521095e-04
Gmres(7) iteration complete. Remaining residual: 4.029530e-05
Gmres(8) iteration complete. Remaining residual: 1.632393e-05
Gmres(9) iteration complete. Remaining residual: 5.028700e-06
Gmres has converged in 9 iterations: RelativeResidual - The residual magnitude has decreased to a fraction of 0.001 of its initial value or below (0.000615893).
NewtonRaphson(3) iteration complete (0 globalization steps, step length 1). Remaining residual: 1.690461e-03
Gmres initialized with residual: 1.690461e-03
Gmres(1) iteration complete. Remaining residual: 6.584416e-06
Gmres(2) iteration complete. Remaining residual: 5.651935e-06
Gmres(3) iteration complete. Remaining residual: 5.288583e-06
Gmres(4) iteration complete. Remaining residual: 4.922907e-06
Gmres(5) iteration complete. Remaining residual: 4.250901e-06
Gmres(6) iteration complete. Remaining residual: 1.596286e-06
Gmres has converged in 6 iterations: RelativeResidual - The residual magnitude has decreased to a fraction of 0.001 of its initial value or below (0.00094429).
NewtonRaphson(4) iteration complete (0 globalization steps, step length 1). Remaining residual: 1.606242e-06
Gmres initialized with residual: 1.606242e-06
Gmres(1) iteration complete. Remaining residual: 7.008839e-07
Gmres(2) iteration complete. Remaining residual: 5.285042e-07
Gmres(3) iteration complete. Remaining residual: 4.919028e-07
Gmres(4) iteration complete. Remaining residual: 3.871318e-07
Gmres(5) iteration complete. Remaining residual: 1.603757e-07
Gmres(6) iteration complete. Remaining residual: 2.922369e-08
Gmres(7) iteration complete. Remaining residual: 1.438336e-08
Gmres(8) iteration complete. Remaining residual: 5.271254e-09
Gmres(9) iteration complete. Remaining residual: 2.125873e-09
Gmres(10) iteration complete. Remaining residual: 1.044162e-09
Gmres has converged in 10 iterations: RelativeResidual - The residual magnitude has decreased to a fraction of 0.001 of its initial value or below (0.000650065).
NewtonRaphson(5) iteration complete (0 globalization steps, step length 1). Remaining residual: 1.066508e-09
Gmres initialized with residual: 1.066508e-09
Gmres(1) iteration complete. Remaining residual: 8.000055e-10
Gmres(2) iteration complete. Remaining residual: 5.991477e-10
Gmres(3) iteration complete. Remaining residual: 4.073811e-10
Gmres(4) iteration complete. Remaining residual: 2.559880e-10
Gmres(5) iteration complete. Remaining residual: 1.242268e-10
Gmres(6) iteration complete. Remaining residual: 3.521815e-11
Gmres has converged in 6 iterations: AbsoluteResidual - The residual magnitude has decreased to 1e-10 or below (3.52181e-11).
NewtonRaphson(6) iteration complete (0 globalization steps, step length 1). Remaining residual: 3.589802e-11
NewtonRaphson has converged in 6 iterations: AbsoluteResidual - The residual magnitude has decreased to 1e-10 or below (3.5898e-11).

Done!
Wall time in seconds: 769.172052
Date and time at completion: Tue Feb 22 15:21:03 2022

[Partition 0][Node 0] End of program
</pre><h1><a class="anchor" id="autotoc_md194"></a>
Load initial data into evolutions</h1>
<p >The executable has created H5 output files with volume data and diagnostics:</p>
<div class="fragment"><div class="line">!ls *.h5</div>
</div><!-- fragment --> <pre class="fragment">BbhReductions.h5  BbhVolume0.h5
</pre><p >The volume data in the <code>BbhVolume*.<a class="el" href="namespaceh5.html" title="Contains functions and classes for manipulating HDF5 files.">h5</a></code> files (one per node) can be imported into evolution executables. It contains the following data:</p>
<div class="fragment"><div class="line">!h5ls -r BbhVolume*.h5</div>
</div><!-- fragment --> <pre class="fragment">/                        Group
/VolumeData.vol          Group
/VolumeData.vol/ObservationId1423324405707320626 Group
/VolumeData.vol/ObservationId1423324405707320626/ConformalFactor Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_xx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_yx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_yy Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_zx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_zy Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ExtrinsicCurvature_zz Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/HamiltonianConstraint Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/InertialCoordinates_x Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/InertialCoordinates_y Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/InertialCoordinates_z Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/Lapse Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/MomentumConstraint_x Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/MomentumConstraint_y Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/MomentumConstraint_z Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ShiftExcess_x Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ShiftExcess_y Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/ShiftExcess_z Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/Shift_x Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/Shift_y Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/Shift_z Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_xx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_yx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_yy Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_zx Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_zy Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/SpatialMetric_zz Dataset {61344}
/VolumeData.vol/ObservationId1423324405707320626/bases Dataset {696}
/VolumeData.vol/ObservationId1423324405707320626/connectivity Dataset {294400}
/VolumeData.vol/ObservationId1423324405707320626/grid_names Dataset {5272}
/VolumeData.vol/ObservationId1423324405707320626/quadratures Dataset {696}
/VolumeData.vol/ObservationId1423324405707320626/total_extents Dataset {696}
/src.tar.gz              Dataset {5307433}
</pre><ul>
<li><code>Lapse</code> ( \(\alpha\)), <code>Shift</code> ( \(\beta^i\)), <code>SpatialMetric</code> ( \(\gamma_{ij}\)) and <code>ExtrinsicCurvature</code> ( \(K_{ij}\)): These quantities solve the Einstein constraint equations in "corotating" coordinates, such that, e.g., \(\partial_t K = 0\). The black holes remain approximately at the same coordinate positions when starting to evolve the initial data in these coordinates. Note that \(\beta^i \propto r\) in these coordinates, which can be large and hence numerically undesireable.</li>
<li><code>ShiftExcess</code> ( \(\beta_\text{excess}^i\)): This shift vector excludes the rotational part, so it is asymptotically small. Import <code>ShiftExcess</code> instead of <code>Shift</code> in an evolution to obtain coordinates in which the black holes are orbiting. Note that only <p class="formulaDsp">
\begin{equation} \beta^i = \beta_\text{background}^i + \beta_\text{excess}^i \end{equation}
</p>
 fulfills all coordinate conditions imposed on the initial data, such as \(\partial_t K = 0\). The background shift is typically <p class="formulaDsp">
\begin{equation} \beta_\text{background}^i = \epsilon^{ijk} \Omega^{j} x^k + \dot{a}_0 x^i \text{,} \end{equation}
</p>
 where \(\Omega\) is the orbital angular velocity and \(\dot{a}_0\) is the expansion parameter. See the <a href="https://spectre-code.org/classXcts_1_1AnalyticData_1_1Binary.html">Xcts::AnalyticData::Binary</a> class for details.</li>
</ul>
<h1><a class="anchor" id="autotoc_md195"></a>
Plot diagnostics</h1>
<p >We plot the diagnostics in <code>BbhReductions.h5</code> to see what happened during the elliptic solve:</p>
<div class="fragment"><div class="line"><span class="comment"># These routines read the data and process them a bit. You can skip to the plot</span></div>
<div class="line"><span class="comment"># below to see the results.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>split_iteration_sequence(data):</div>
<div class="line">    left_bounds = np.where(data.index == 0)[0]</div>
<div class="line">    right_bounds = list(left_bounds[1:]) + [-1]</div>
<div class="line">    <span class="keywordflow">return</span> [data.iloc[i:j] <span class="keywordflow">for</span> i, j <span class="keywordflow">in</span> zip(left_bounds, right_bounds)]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">def </span>load_dataset(subfile):</div>
<div class="line">    legend = subfile.attrs[<span class="stringliteral">&quot;Legend&quot;</span>]</div>
<div class="line">    <span class="keywordflow">return</span> pd.DataFrame(data=subfile, columns=legend).set_index(legend[0])</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">with</span> h5py.File(<span class="stringliteral">&quot;BbhReductions.h5&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>) <span class="keyword">as</span> h5_file:</div>
<div class="line">    nonlinear_residuals = load_dataset(h5_file[<span class="stringliteral">&quot;NewtonRaphsonResiduals.dat&quot;</span>])</div>
<div class="line">    all_linear_residuals = split_iteration_sequence(</div>
<div class="line">        load_dataset(h5_file[<span class="stringliteral">&quot;GmresResiduals.dat&quot;</span>])</div>
<div class="line">    )</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment"># Plot linear residuals</span></div>
<div class="line">n = 0</div>
<div class="line">lin_label = <span class="stringliteral">&quot;Linear residual&quot;</span></div>
<div class="line"><span class="keywordflow">for</span> linear_residuals <span class="keywordflow">in</span> all_linear_residuals:</div>
<div class="line">    plt.semilogy(</div>
<div class="line">        linear_residuals.index + n,</div>
<div class="line">        linear_residuals[<span class="stringliteral">&quot;Residual&quot;</span>]</div>
<div class="line">        / all_linear_residuals[0][<span class="stringliteral">&quot;Residual&quot;</span>].iloc[0],</div>
<div class="line">        color=<span class="stringliteral">&quot;black&quot;</span>,</div>
<div class="line">        label=lin_label,</div>
<div class="line">        marker=<span class="stringliteral">&quot;.&quot;</span>,</div>
<div class="line">        markersize=2.5,</div>
<div class="line">        zorder=30,</div>
<div class="line">    )</div>
<div class="line">    n += len(linear_residuals) - 1</div>
<div class="line">    lin_label = <span class="keywordtype">None</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Plot nonlinear residuals</span></div>
<div class="line">nonlin_xticks = [0] + list(</div>
<div class="line">    np.cumsum([len(l) - 1 <span class="keywordflow">for</span> l <span class="keywordflow">in</span> all_linear_residuals])</div>
<div class="line">)</div>
<div class="line">plt.semilogy(</div>
<div class="line">    nonlin_xticks,</div>
<div class="line">    nonlinear_residuals[<span class="stringliteral">&quot;Residual&quot;</span>] / nonlinear_residuals[<span class="stringliteral">&quot;Residual&quot;</span>].iloc[0],</div>
<div class="line">    color=<span class="stringliteral">&quot;black&quot;</span>,</div>
<div class="line">    ls=<span class="stringliteral">&quot;dotted&quot;</span>,</div>
<div class="line">    marker=<span class="stringliteral">&quot;.&quot;</span>,</div>
<div class="line">    label=<span class="stringliteral">&quot;Nonlinear residual&quot;</span>,</div>
<div class="line">    zorder=40,</div>
<div class="line">)</div>
<div class="line">plt.xticks(nonlin_xticks)</div>
<div class="line">xticks = (</div>
<div class="line">    range(len(all_linear_residuals))</div>
<div class="line">    <span class="keywordflow">if</span> nonlinear_residuals <span class="keywordflow">is</span> <span class="keywordtype">None</span></div>
<div class="line">    <span class="keywordflow">else</span> nonlin_xticks</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">plt.xlabel(<span class="stringliteral">&quot;Cumulative linear solver iteration&quot;</span>)</div>
<div class="line">plt.legend();</div>
</div><!-- fragment --><div class="image">
<img src="BbhInitialData_17_0.png" alt=""/>
<div class="caption">
png</div></div>
   <p >The plot shows the convergence of the nonlinear solver (dotted line), along with the convergence of the linear solver that runs in each nonlinear iteration (solid line). A few things to note:</p>
<ul>
<li>The residual converges down to almost machine precision, but that doesn't reflect the discretization error of the solution. It only shows that we have solved the discretized problem very accurately. To get an idea of the discretization error we would have to look at quantities such as constraint norms.</li>
<li>The Newton-Raphson nonlinear solver converges slowly at first, and then begins to converge quadratically once we are closer to the solution and hence the linearization is more accurate.</li>
<li>The linear solver needs only a few steps to converge, which is a feature of our multigrid-Schwarz preconditioner.</li>
</ul>
<p >You can read more about the elliptic solver in this paper:</p>
<ul>
<li>N. L. Vu <em>et al</em>., A scalable elliptic solver with task-based parallelism for the SpECTRE numerical relativity code (2022), <a href="https://arxiv.org/abs/2111.06767">arXiv:2111.06767</a></li>
</ul>
<div class="fragment"></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="examples.html">Examples</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
