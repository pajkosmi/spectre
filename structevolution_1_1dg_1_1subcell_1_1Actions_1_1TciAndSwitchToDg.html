<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: evolution::dg::subcell::Actions::TciAndSwitchToDg&lt; TciMutator &gt; Struct Template Reference</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('structevolution_1_1dg_1_1subcell_1_1Actions_1_1TciAndSwitchToDg.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="structevolution_1_1dg_1_1subcell_1_1Actions_1_1TciAndSwitchToDg-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">evolution::dg::subcell::Actions::TciAndSwitchToDg&lt; TciMutator &gt; Struct Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Run the troubled-cell indicator on the subcell solution to see if it is safe to switch back to DG.  
 <a href="structevolution_1_1dg_1_1subcell_1_1Actions_1_1TciAndSwitchToDg.html#details">More...</a></p>

<p><code>#include &lt;TciAndSwitchToDg.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ab2c3b003f8b7d4edcc7cab7e377d49df"><td class="memTemplParams" colspan="2"><a id="ab2c3b003f8b7d4edcc7cab7e377d49df" name="ab2c3b003f8b7d4edcc7cab7e377d49df"></a>
template&lt;typename DbTags , typename... InboxTags, typename Metavariables , typename ArrayIndex , typename ActionList , typename ParallelComponent , size_t Dim = Metavariables::volume_dim&gt; </td></tr>
<tr class="memitem:ab2c3b003f8b7d4edcc7cab7e377d49df"><td class="memTemplItemLeft" align="right" valign="top">static <a class="el" href="namespaceParallel.html#af78863455c4051f7335d78eaa9c5c4e8">Parallel::iterable_action_return_t</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><b>apply</b> (db::DataBox&lt; DbTags &gt; &amp;box, const <a class="el" href="classtuples_1_1TaggedTuple.html">tuples::TaggedTuple</a>&lt; InboxTags... &gt; &amp;, const <a class="el" href="classParallel_1_1GlobalCache.html">Parallel::GlobalCache</a>&lt; Metavariables &gt; &amp;, const ArrayIndex &amp;, const ActionList, const ParallelComponent *const)</td></tr>
<tr class="separator:ab2c3b003f8b7d4edcc7cab7e377d49df"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename TciMutator&gt;<br />
struct evolution::dg::subcell::Actions::TciAndSwitchToDg&lt; TciMutator &gt;</div><p >Run the troubled-cell indicator on the subcell solution to see if it is safe to switch back to DG. </p>
<p >In terms of the DG-subcell/FD hybrid solver, this action is run after the FD step has calculated the solution at \(t^{n+1}\). At this point we check if the FD solution at the new time \(t^{n+1}\) is representable on the DG grid.</p>
<p >The algorithm proceeds as follows:</p><ol type="1">
<li>If we are using a substep time integrator and are not at the end of a step, or we are in the self-starting stage of a multistep method, or the <code>subcell_options.always_use_subcells() == true</code>, then we do not run any TCI or try to go back to DG. We need to avoid reconstructing (in the sense of the inverse of projecting the DG solution to the subcells) the time stepper history if there are shocks present in the history, and for substep methods this is most easily handled by only switching back at the end of a full time step. During the self-start phase of the multistep time integrators we integrate over the same region of time at increasingly higher order, which means if we were on subcell "previously" (since we use a forward-in-time self-start method the time history is actually in the future of the current step) then we will very likely need to again switch to subcell.</li>
<li>Reconstruct the subcell solution to the DG grid.</li>
<li>Run the relaxed discrete maximum principle (RDMP) troubled-cell indicator (TCI), checking both the subcell solution at \(t^{n+1}\) and the reconstructed DG solution at \(t^{n+1}\) to make sure they are admissible.</li>
<li>If the RDMP TCI marked the DG solution as admissible, run the user-specified mutator TCI <code>TciMutator</code>.</li>
<li>If the cell is not troubled, and the time integrator type is substep or the TCI history indicates the entire history for the multistep method is free of discontinuities, then we can switch back to DG. Switching back to DG requires reconstructing dg variables, reconstructing the time stepper history, marking the active grid as <code>ActiveGrid::Dg</code>, and clearing the subcell neighbor data.</li>
<li>If we are not using a substep method, then record the TCI decision in the <code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1TciGridHistory.html" title="A record of which grid the TCI requested we use.">subcell::Tags::TciGridHistory</a></code>.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>Unlike <code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Actions_1_1TciAndRollback.html" title="Run the troubled-cell indicator on the candidate solution and perform the time step rollback if neede...">Actions::TciAndRollback</a></code>, this action does <em>not</em> jump back to <code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Actions_1_1Labels_1_1BeginDg.html" title="Label marking the start of the unlimited DG solver.">Labels::BeginDg</a></code>. This is because users may add actions after a time step has been completed. In that sense, it may be more proper to actually check the TCI and switch back to DG at the start of the step rather than the end.</dd>
<dd>
This action always sets <code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1DidRollback.html" title="Tag indicating whether we are retrying a step after a rollback of a failed DG step.">subcell::Tags::DidRollback</a></code> to <code>false</code> at the very beginning since this action is called after an FD step has completed.</dd>
<dd>
If <code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1DidRollback.html" title="Tag indicating whether we are retrying a step after a rollback of a failed DG step.">subcell::Tags::DidRollback</a>=True</code> i.e. the grid has been switched from DG to FD in the current time step by preceding actions, this action is skipped except setting <code>DidRollback</code> to <code>false</code>. Stated differently, if an element switched from DG to FD it needs to remain at least one time step on the FD grid.</dd></dl>
<p>GlobalCache:</p><ul>
<li>Uses:<ul>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1SubcellOptions.html" title="System-agnostic options for DG-subcell.">subcell::Tags::SubcellOptions</a></code></li>
</ul>
</li>
</ul>
<p >DataBox:</p><ul>
<li>Uses:<ul>
<li><code><a class="el" href="structdomain_1_1Tags_1_1Mesh.html" title="The computational grid of the Element in the DataBox.">domain::Tags::Mesh</a>&lt;Dim&gt;</code></li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1Mesh.html" title="The mesh on the subcells.">subcell::Tags::Mesh</a>&lt;Dim&gt;</code></li>
<li><code><a class="el" href="structTags_1_1TimeStepId.html" title="Tag for TimeStepId for the algorithm state.">Tags::TimeStepId</a></code></li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1ActiveGrid.html" title="The grid currently used for the DG-subcell evolution on the element.">subcell::Tags::ActiveGrid</a></code></li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1DataForRdmpTci.html" title="The data for the RDMP troubled-cell indicator.">subcell::Tags::DataForRdmpTci</a></code></li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1TciGridHistory.html" title="A record of which grid the TCI requested we use.">subcell::Tags::TciGridHistory</a></code></li>
</ul>
</li>
<li>Adds: nothing</li>
<li>Removes: nothing</li>
<li>Modifies:<ul>
<li><code>System::variables_tag</code> if the cell is not troubled</li>
<li><code><a class="el" href="structTags_1_1HistoryEvolvedVariables.html" title="Tag for the TimeStepper history.">Tags::HistoryEvolvedVariables</a></code> if the cell is not troubled</li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1ActiveGrid.html" title="The grid currently used for the DG-subcell evolution on the element.">subcell::Tags::ActiveGrid</a></code> if the cell is not troubled</li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1DidRollback.html" title="Tag indicating whether we are retrying a step after a rollback of a failed DG step.">subcell::Tags::DidRollback</a></code> sets to <code>false</code></li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1TciDecision.html" title="Stores the status of the troubled cell indicator in the element as an int.">subcell::Tags::TciDecision</a></code> is set to an integer value according to the return of TciMutator.</li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1GhostDataForReconstruction.html" title="The ghost data used for reconstructing the solution on the interfaces between elements.">subcell::Tags::GhostDataForReconstruction</a>&lt;Dim&gt;</code> if the cell is not troubled</li>
<li><code><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Tags_1_1TciGridHistory.html" title="A record of which grid the TCI requested we use.">subcell::Tags::TciGridHistory</a></code> if the time stepper is a multistep method </li>
</ul>
</li>
</ul>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>src/Evolution/DgSubcell/Actions/TciAndSwitchToDg.hpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceevolution.html">evolution</a></li><li class="navelem"><a class="el" href="namespaceevolution_1_1dg.html">dg</a></li><li class="navelem"><a class="el" href="namespaceevolution_1_1dg_1_1subcell.html">subcell</a></li><li class="navelem"><a class="el" href="namespaceevolution_1_1dg_1_1subcell_1_1Actions.html">Actions</a></li><li class="navelem"><a class="el" href="structevolution_1_1dg_1_1subcell_1_1Actions_1_1TciAndSwitchToDg.html">TciAndSwitchToDg</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
