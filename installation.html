<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: Installation</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('installation.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Installation </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md0">Install a specific version with Spack</a></li>
<li class="level2"><a href="#autotoc_md1">Quick-start guide for code development with Docker and Visual Studio Code</a></li>
<li class="level2"><a href="#autotoc_md2">Dependencies</a><ul><li class="level3"><a href="#autotoc_md3">Required:</a></li>
<li class="level3"><a href="#autotoc_md4">Optional:</a></li>
</ul>
</li>
</ul>
<li class="level1"><a href="#autotoc_md5">Clone the SpECTRE repository</a></li>
<li class="level1"><a href="#docker_install">Using Docker to obtain a SpECTRE environment</a></li>
<li class="level1"><a href="#autotoc_md6">Using Singularity to obtain a SpECTRE environment</a></li>
<li class="level1"><a href="#autotoc_md7">Using Spack to set up a SpECTRE environment</a></li>
<li class="level1"><a href="#building-charm">Building Charm++</a></li>
<li class="level1"><a href="#building-spectre">Building SpECTRE</a></li>
<li class="level1"><a href="#autotoc_md8">Code Coverage Analysis</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_Installation_Installation"></a></p>
<p >This page details the installation procedure for SpECTRE on personal computers using x86-64 processors. For instructions on installing SpECTRE on clusters please refer to the <a class="el" href="installation_on_clusters.html">Installation on Clusters</a> page. For instructions on installing SpECTRE on Apple Silicon Macs, please refer to the <a class="el" href="installation_on_apple_silicon.html">Installing SpECTRE on Apple Silicon</a> page. Refer to the <a class="el" href="versioning_and_releases.html">Versioning and releases</a> page for information on specific versions to install.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Install a specific version with Spack</h2>
<p >You can install SpECTRE with the <a href="https://github.com/spack/spack">Spack</a> package manager:</p>
<div class="fragment"><div class="line">git clone https://github.com/spack/spack</div>
<div class="line">source ./spack/share/spack/setup-env.sh</div>
<div class="line">spack compiler find</div>
<div class="line">spack external find</div>
<div class="line">spack install spectre executables=ExportCoordinates3D \</div>
<div class="line">  ^charmpp backend=multicore</div>
</div><!-- fragment --><p >You probably want to customize your installation, e.g., to select a particular version of SpECTRE, the executables you want to install, additional options such as Python bindings, or the Charm++ backend. You can display all possible options with:</p>
<div class="fragment"><div class="line">spack info spectre  # or charmpp, etc.</div>
</div><!-- fragment --><p >Refer to the <a href="https://spack.readthedocs.io/en/latest/">Spack documentation</a> for more information.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Quick-start guide for code development with Docker and Visual Studio Code</h2>
<p >If you're new to writing code for SpECTRE and would like to jump right into a working development environment, a good place to start is our <a class="el" href="dev_guide_quick_start_docker_vscode.html">Code development quick-start with Docker and Visual Studio Code</a>. If you prefer setting up your development environment differently, read on!</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Dependencies</h2>
<p ><b>Note</b>: You don't need to install any of these dependencies by hand, or by using yum, apt, or other package managers; it is much easier to instead use Singularity, Docker, or Spack (see the corresponding sections below) to obtain an environment that includes all of these dependencies.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Required:</h3>
<ul>
<li><a href="https://gcc.gnu.org/">GCC</a> 9.1 or later, <a href="https://clang.llvm.org/">Clang</a> 10.0 or later, or AppleClang 11.0.0 or later</li>
<li><a href="https://cmake.org/">CMake</a> 3.18.0 or later</li>
<li><a href="http://charm.cs.illinois.edu/">Charm++</a> 7.0.0, or later (experimental) <a class="el" href="citelist.html#CITEREF_Charmpp1">[88]</a> <a class="el" href="citelist.html#CITEREF_Charmpp2">[89]</a> <a class="el" href="citelist.html#CITEREF_Charmpp3">[87]</a></li>
<li><a href="https://git-scm.com/">Git</a></li>
<li>BLAS (e.g. <a href="http://www.openblas.net">OpenBLAS</a>)</li>
<li><a href="https://bitbucket.org/blaze-lib/blaze/overview">Blaze</a> v3.8. It can be beneficial to install Blaze with CMake so some configuration options are determined automatically, such as cache sizes. <a class="el" href="citelist.html#CITEREF_Blaze1">[84]</a> <a class="el" href="citelist.html#CITEREF_Blaze2">[83]</a></li>
<li><a href="http://www.boost.org/">Boost</a> 1.60.0 or later</li>
<li><a href="https://github.com/edouarda/brigand">Brigand</a> at commit 1c398e4f1e817ab195e4cd6fbb03c18cb386eea3 (late 2020) or later</li>
<li><a href="https://github.com/catchorg/Catch2">Catch</a> 2.8.0 or later, but not 3.x as SpECTRE doesn't support v3 yet (If installing from source, it is easiest to use single-header installation)</li>
<li><a href="https://www.gnu.org/software/gsl/">GSL</a> <a class="el" href="citelist.html#CITEREF_Gsl">[65]</a></li>
<li><a href="https://support.hdfgroup.org/HDF5/">HDF5</a> (non-mpi version on macOS) <a class="el" href="citelist.html#CITEREF_Hdf5">[159]</a></li>
<li><a href="https://github.com/jemalloc/jemalloc">jemalloc</a></li>
<li>LAPACK</li>
<li><a href="https://github.com/Libsharp/libsharp">libsharp</a> should be built with support disabled for openmp and mpi, as we want all of our parallelism to be accomplished via Charm++. <a class="el" href="citelist.html#CITEREF_Libsharp">[139]</a></li>
<li><a href="https://github.com/hfp/libxsmm">LIBXSMM</a> version 1.16.1 or later <a class="el" href="citelist.html#CITEREF_Libxsmm">[78]</a></li>
<li><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a> version 0.6.3 or later. Building with shared library support is also recommended. <a class="el" href="citelist.html#CITEREF_Yamlcpp">[17]</a></li>
<li><a href="https://www.python.org/">Python</a> 3.7 or later.</li>
<li>Python dependencies listed in <code>support/Python/requirements.txt</code>. Install with <code>pip3 install -r support/Python/requirements.txt</code>. Make sure you are working in a <a href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment">Python venv</a> before installing packages. Alternatively, you can set <code>BOOTSTRAP_PY_DEPS=ON</code> when configuring a build with CMake to install missing Python packages into the build directory automatically. <details>
 <div class="fragment"><div class="line"><span class="preprocessor"># Distributed under the MIT License.</span></div>
<div class="line"><span class="preprocessor"># See LICENSE.txt for details.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Python packages needed to run the Python bindings.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Make sure that you are working in a Python venv. You can set one up like this</span></div>
<div class="line"><span class="preprocessor"># in a directory of your choice:</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">#   $ python3 -m venv path/to/env</span></div>
<div class="line"><span class="preprocessor">#   $ . path/to/env/bin/activate</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Then, install the Python dependencies into the environment like this:</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">#   $ pip3 install -r support/Python/requirements.txt</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Click: to compose our Python CLI, load subcommands lazily, and for</span></div>
<div class="line"><span class="preprocessor"># autocompletion</span></div>
<div class="line">click</div>
<div class="line">h5py &gt;= 3.5.0</div>
<div class="line"><span class="preprocessor"># Humanize: For human-readable output like &quot;2 hours ago&quot;</span></div>
<div class="line">humanize</div>
<div class="line"><span class="preprocessor"># - We constrain the Numpy version because v1.22+ segfaults in Pypp tests, see</span></div>
<div class="line"><span class="preprocessor">#   issue: https:</span><span class="comment">//github.com/sxs-collaboration/spectre/issues/3844</span></div>
<div class="line">numpy &lt; 1.22.0</div>
<div class="line">matplotlib</div>
<div class="line"><span class="preprocessor"># Pandas: To work with columns of data. Need a sufficiently recent version</span></div>
<div class="line"><span class="preprocessor"># to do some fancy indexing in Status CLI</span></div>
<div class="line">pandas ~= 1.5</div>
<div class="line">pyyaml</div>
<div class="line"><span class="preprocessor"># Rich: to format CLI output and tracebacks</span></div>
<div class="line">rich &gt;= 12.0.0</div>
<div class="line">scipy</div>
</div><!-- fragment --> </details>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md4"></a>
Optional:</h3>
<ul>
<li><a href="https://pybind11.readthedocs.io">Pybind11</a> 2.6.0 or later for SpECTRE Python bindings <a class="el" href="citelist.html#CITEREF_Pybind11">[85]</a></li>
<li><a href="https://www.doxygen.nl/index.html">Doxygen</a> 1.9.1 or later — to generate documentation</li>
<li>Python dev dependencies listed in <code>support/Python/dev_requirements.txt</code> — for documentation pre- and post-processing, formatting code, etc. Install with <code>pip3 install -r support/Python/dev_requirements.txt</code>. Make sure you are working in a <a href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/#creating-a-virtual-environment">Python venv</a> before installing packages. <details>
 <div class="fragment"><div class="line"><span class="preprocessor"># Distributed under the MIT License.</span></div>
<div class="line"><span class="preprocessor"># See LICENSE.txt for details.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Optional Python packages used for development, but not for running the code.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Make sure that you are working in a Python venv. You can set one up like this</span></div>
<div class="line"><span class="preprocessor"># in a directory of your choice:</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">#   $ python3 -m venv path/to/env</span></div>
<div class="line"><span class="preprocessor">#   $ . path/to/env/bin/activate</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor"># Then, install the Python dependencies into the environment like this:</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">#   $ pip3 install -r support/Python/dev_requirements.txt</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Building and postprocessing documentation</span></div>
<div class="line">beautifulsoup4</div>
<div class="line">coverxygen</div>
<div class="line">nbconvert</div>
<div class="line">pybtex</div>
<div class="line">sphinx</div>
<div class="line">furo</div>
<div class="line">myst-parser</div>
<div class="line"><span class="preprocessor"># Code formatting. The required version is locked in the pyproject.toml config.</span></div>
<div class="line">black ~= 23.3</div>
<div class="line">isort ~= 5.12</div>
</div><!-- fragment --> </details>
</li>
<li><a href="https://github.com/google/benchmark">Google Benchmark</a> - to do microbenchmarking inside the SpECTRE framework. v1.2 or newer is required</li>
<li><a href="http://ltp.sourceforge.net/coverage/lcov.php">LCOV</a> and <a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">gcov</a> — to check code test coverage</li>
<li><a href="http://icl.utk.edu/papi/">PAPI</a> — to access hardware performance counters</li>
<li><a href="https://clang.llvm.org/docs/ClangFormat.html">ClangFormat</a> — to format C++ code in a clear and consistent fashion</li>
<li><a href="http://clang.llvm.org/extra/clang-tidy/">Clang-Tidy</a> — to "lint" C++ code</li>
<li><a href="http://cppcheck.sourceforge.net/">Cppcheck</a> — to analyze C++ code</li>
<li><a href="https://gitlab.inria.fr/scotch/scotch">Scotch</a> - to build the <code>ScotchLB</code> graph partition based load balancer in charm++.</li>
<li><a href="https://www.ffmpeg.org/">ffmpeg</a> - for animating 1d simulations with matplotlib</li>
<li><a href="https://github.com/xtensor-stack/xsimd">xsimd</a> - for manual vectorization</li>
<li><a href="https://github.com/ianlancetaylor/libbacktrace">libbacktrace</a> - to show source files and line numbers in backtraces of errors and asserts. Available by default on many systems, so you may not have to install it at all. The CMake configuration will tell you if you have libbacktrace installed.</li>
<li><a href="https://www.paraview.org/">ParaView</a> - for visualization <a class="el" href="citelist.html#CITEREF_Paraview1">[6]</a> <a class="el" href="citelist.html#CITEREF_Paraview2">[1]</a></li>
<li><a href="https://www.black-holes.org/code/SpEC.html">SpEC</a> - to load SpEC data. Compile the exporter in SpEC's <code>Support/ApplyObservers/Exporter/</code> directory (see the <code>Makefile</code> in that directory). Also make sure to compile SpEC with the same compiler and MPI as SpECTRE to avoid compatibility issues.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Clone the SpECTRE repository</h1>
<p >First, clone the <a href="https://github.com/sxs-collaboration/spectre">SpECTRE repository</a> to a directory of your choice. In the following we will refer to it as SPECTRE_ROOT. You may <code>git clone</code> from GitHub, in which case SPECTRE_ROOT will be <code>&lt;your_current_directory&gt;/spectre</code>. That is, inside SPECTRE_ROOT are <code>docs</code>, <code>src</code>, <code>support</code>, <code>tests</code> etc. You can also download the source and extract them to your desired working directory, making sure not to leave out hidden files when you <code>cp</code> or <code>mv</code> the source files.</p>
<h1><a class="anchor" id="docker_install"></a>
Using Docker to obtain a SpECTRE environment</h1>
<p >A <a href="https://www.docker.com/">Docker</a> image is available from <a href="https://hub.docker.com/r/sxscollaboration/spectre/">DockerHub</a> and can be used to build SpECTRE on a personal machine.</p>
<p ><b>Note</b>: The Docker image or the Singularity image (see below) are the recommended ways of using SpECTRE on a personal Linux machine. Because of the wide variety of operating systems available today it is not possible for us to support all configurations. However, using Spack as outlined below is a supported alternative to Docker or Singularity images.</p>
<p ><b>Note</b>: If you have SELinux active on your system you must figure out how to enable sharing files with the host OS. If you receive errors that you do not have permission to access a shared directory it is likely that your system has SELinux enabled. One option is to disable SELinux at the expense of reducing the security of your system.</p>
<p >To build with the Docker image:</p>
<ol type="1">
<li>Install <a href="https://docs.docker.com/get-docker/">Docker-Desktop</a>. For Linux, if you want to be able to run the following steps without <code>sudo</code>, follow the <a href="https://docs.docker.com/engine/install/linux-postinstall/">post-installation-guide</a> to add a non-root user.</li>
<li>Retrieve the Docker image (you may need <code>sudo</code> in front of this command) <div class="fragment"><div class="line">docker pull sxscollaboration/spectre:dev</div>
</div><!-- fragment --></li>
<li><p class="startli">Start the Docker container (you may need <code>sudo</code>) </p><div class="fragment"><div class="line">docker run -v $SPECTRE_ROOT/:$SPECTRE_ROOT/ --name spectre_dev \</div>
<div class="line">           -i -t sxscollaboration/spectre:dev /bin/bash</div>
</div><!-- fragment --><ul>
<li><code>-v $SPECTRE_ROOT/:$SPECTRE_ROOT/</code> binds the directory <code>$SPECTRE_ROOT</code> (which is an environment variable you must set up or just use the actual path) outside the container to <code>$SPECTRE_ROOT</code> inside the container. In this way, files in the <code>$SPECTRE_ROOT</code> on your host system (outside the container) become accessible within the container through the directory SPECTRE_ROOT inside the container. If you wonder why the same SPECTRE_ROOT needs to be used for both inside and outside the container, which is why <code>$SPECTRE_ROOT</code> is repeated in the command above with separated by a colon, please see one of the notes below regarding <code>-v</code> flag.</li>
<li>The <code>--name spectre_dev</code> is optional. If you don't name your container, docker will generate an arbitrary name.</li>
<li>On macOS you can significantly increase the performance of file system operations by appending the flag <code>:delegated</code> to <code>-v</code>, e.g. <code>-v $SPECTRE_ROOT/:$SPECTRE_ROOT/:delegated</code> (see <a href="https://docs.docker.com/docker-for-mac/osxfs-caching/">https://docs.docker.com/docker-for-mac/osxfs-caching/</a>).</li>
<li>The <code>-i</code> flag is for interactive mode, which will drop you into the container.</li>
<li>It can be useful to expose a port to the host so you can run servers such as <a href="https://jupyter.org/index.html">Jupyter</a> for accessing the Python bindings (see <a class="el" href="spectre_using_python.html">Using SpECTRE's Python modules</a>) or a Python web server to view the documentation. To do so, append the <code>-p</code> option, e.g. <code>-p 8000:8000</code>.</li>
</ul>
<p class="startli">You will end up in a bash shell in the docker container, as root (you need to be root). Within the container, the files in <code>$SPECTRE_ROOT</code> are available and Charm++ is installed in <code>/work/charm_7_0_0</code>. For the following steps, stay inside the docker container as root.</p>
</li>
<li>Proceed with <a class="el" href="installation.html#building-spectre">building SpECTRE</a>.</li>
</ol>
<p ><b>Notes:</b></p><ul>
<li>Everything in your build directory is owned by root, and is accessible only within the container.</li>
<li>You should edit source files in SPECTRE_ROOT in a separate terminal outside the container, and use the container only for compiling and running the code.</li>
<li>If you exit the container (e.g. ctrl-d), your compilation directories are still saved, as are any other changes to the container that you have made. To restart the container, try the following commands (you may need <code>sudo</code>):<ol type="1">
<li><code>docker ps -a</code>, to list all containers with their CONTAINER_IDs and CONTAINER_NAMEs,</li>
<li><code>docker start -i CONTAINER_NAME</code> or <code>docker start -i CONTAINER_ID</code>, to restart your container (above, the CONTAINER_NAME was spectre_dev).</li>
</ol>
</li>
<li>When the Docker container gets updated, you can stop it with <code>docker stop CONTAINER_NAME</code>, remove it with <code>docker rm CONTAINER_NAME</code> and then start at step 2 above to run it again.</li>
<li>You can run more than one shell in the same container, for instance one shell for compiling with gcc and another for compiling with clang. To add a new shell, run <code>docker exec -it CONTAINER_NAME /bin/bash</code> (or <code>docker exec -it CONTAINER_ID /bin/bash</code>) from a terminal outside the container.</li>
<li>In step 4 above, technically docker allows you to say <code>-v $SPECTRE_ROOT/:/my/new/path</code> to map <code>$SPECTRE_ROOT</code> outside the container to any path you want inside the container, but <b>do not do this</b>. Compiling inside the container sets up git hooks in SPECTRE_ROOT that contain hardcoded pathnames to SPECTRE_ROOT <em>as seen from inside the container</em>. So if your source paths inside and outside the container are different, commands like <code>git commit</code> run <em>from outside the container</em> will die with <code>No such file or directory</code>.</li>
<li>If you want to use Docker within VSCode, take a look at our <a class="el" href="dev_guide_quick_start_docker_vscode.html#md_docs_DevGuide_QuickStartDockerVSCode">quick start guide</a> for using Docker with VSCode.</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Using Singularity to obtain a SpECTRE environment</h1>
<p ><a href="https://sylabs.io">Singularity</a> is a container alternative to Docker with better security and nicer integration.</p>
<p >To build SpECTRE with Singularity you must:</p>
<ol type="1">
<li>Build <a href="https://sylabs.io">Singularity</a> and add it to your <code>$PATH</code></li>
<li><code>cd</code> to the directory where you want to store the SpECTRE Singularity image, source, and build directories, let's call it WORKDIR. The WORKDIR must be somewhere in your home directory. If this does not work for you, follow the Singularity instructions on setting up additional <a href="https://sylabs.io/guides/3.7/user-guide/bind_paths_and_mounts.html">bind points</a> (version 3.7. For other versions, see the <a href="https://sylabs.io/docs/">docs</a>). Once inside the WORKDIR, clone SpECTRE into <code>WORKDIR/SPECTRE_ROOT</code>.</li>
<li><p class="startli">Run <code>sudo singularity build spectre.img docker://sxscollaboration/spectre:dev</code>. You can also use spectre:ci instead of spectre:dev if you want more compilers installed.</p>
<p class="startli">If you get the error message that <code>makesquashfs</code> did not have enough space to create the image you need to set a different <code>SINGULARITY_TMPDIR</code>. This can be done by running: <code>sudo SINGULARITY_TMPDIR=/path/to/new/tmp singularity build spectre.img docker://sxscollaboration/spectre:dev</code>. Normally <code>SINGULARITY_TMPDIR</code> is <code>/tmp</code>, but building the image will temporarily need almost 8GB of space.</p>
<p class="startli">You can control where Singularity stores the downloaded image files from DockerHub by specifying the <code>SINGULARITY_CACHEDIR</code> environment variable. The default is <code>$HOME/.singularity/</code>. Note that <code>$HOME</code> is <code>/root</code> when running using <code>sudo</code>.</p>
</li>
<li>To start the container run <code>singularity shell spectre.img</code> and you will be dropped into a bash shell.</li>
<li>Proceed with <a class="el" href="installation.html#building-spectre">building SpECTRE</a>.</li>
</ol>
<p ><b>Notes:</b></p><ul>
<li>You should edit source files in SPECTRE_ROOT in a separate terminal outside the container, and use the container only for compiling and running the code.</li>
<li>If you don't have the same Python version in your environment outside the container as the version inside the container, this will create problems with git hooks. The Singularity container uses python3.8 by default. Thus, it is up to the user to ensure that they are using the same Python version inside and outside the container. To use a different Python version in the container add <code>-D Python_EXECUTABLE=/path/to/python</code> to the cmake command where <code>/path/to/python</code> is usually <code>/usr/bin/pythonX</code> and <code>X</code> is the version you want.</li>
<li>Unlike Docker, Singularity does not keep the state between runs. However, it shares the home directory with the host OS so you should do all your work somewhere in your home directory.</li>
<li>To run more than one container just do <code>singularity shell spectre.img</code> in another terminal.</li>
<li>Since the data you modify lives on the host OS there is no need to worry about losing any data, needing to clean up old containers, or sharing data between containers and the host.</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Using Spack to set up a SpECTRE environment</h1>
<p >SpECTRE's dependencies can be installed with <a href="https://github.com/spack/spack">Spack</a>, a package manager tailored for HPC use. <a href="https://spack.readthedocs.io/en/latest/getting_started.html">Install Spack</a> by cloning it into <code>SPACK_DIR</code> (a directory of your choice). Then, enable Spack's shell support with <code>source SPACK_DIR/share/spack/setup-env.sh</code>. Consider adding this line to your <code>.bash_profile</code>, <code>.bashrc</code>, or similar. Refer to <a href="https://spack.readthedocs.io/en/latest/getting_started.html">Spack's getting started guide</a> for more information.</p>
<p >Once you have Spack installed, one way to install the SpECTRE dependencies is with a <a href="https://spack.readthedocs.io/en/latest/environments.html">Spack environment</a>:</p>
<div class="fragment"><div class="line"># Distributed under the MIT License.</div>
<div class="line"># See LICENSE.txt for details.</div>
<div class="line"> </div>
<div class="line"># SpECTRE development environment that can be installed with the Spack package</div>
<div class="line"># manager, both on clusters and personal machines.</div>
<div class="line">#</div>
<div class="line"># To install this environment, first clone</div>
<div class="line"># [Spack](https://github.com/spack/spack) and refer to the</div>
<div class="line"># [docs](https://spack.readthedocs.io/) for an introduction to Spack. Then:</div>
<div class="line">#</div>
<div class="line">#   $ spack env create YOUR_ENV_NAME support/DevEnvironments/spack.yaml</div>
<div class="line">#   $ spack env activate YOUR_ENV_NAME -p</div>
<div class="line">#</div>
<div class="line"># Now you can adjust the environment for your system. You may want to `spack</div>
<div class="line"># remove` and `spack add` some packages, e.g., to customize the Charm++</div>
<div class="line"># installation or to omit packages provided by your system or installed via</div>
<div class="line"># another package manager. To generate the list of packages that will be</div>
<div class="line"># installed, run:</div>
<div class="line">#</div>
<div class="line">#   $ spack concretize -f [--reuse]</div>
<div class="line">#</div>
<div class="line"># You may want to run `spack external find` and concretize with `--reuse` to</div>
<div class="line"># avoid reinstalling a bunch of system-provided packages. When you are happy</div>
<div class="line"># with the concretized environment, run:</div>
<div class="line">#</div>
<div class="line">#   $ spack install</div>
<div class="line">#</div>
<div class="line"># All dependencies will be installed in the Spack build tree and linked into the</div>
<div class="line"># environment. Now you can run CMake, build SpECTRE, etc. To pass options like</div>
<div class="line"># `CHARM_ROOT` to CMake, if necessary, you can find the location of installed</div>
<div class="line"># packages with `spack location --install-dir`.</div>
<div class="line">#</div>
<div class="line"># Since the `spack` command is quite slow, you can also generate a module file</div>
<div class="line"># that is much faster to source:</div>
<div class="line">#</div>
<div class="line">#   $ spack env loads -r</div>
<div class="line">#</div>
<div class="line"># Now you can activate the environment by sourcing the generated module file.</div>
<div class="line">#</div>
<div class="line"># See the [Spack docs on environments](https://spack.readthedocs.io/en/latest/environments.html)</div>
<div class="line"># for more information.</div>
<div class="line"> </div>
<div class="line">spack:</div>
<div class="line">  specs:</div>
<div class="line">  - blaze@3.8</div>
<div class="line">  - &#39;boost@1.60:+math+program_options&#39;</div>
<div class="line">  - brigand@master</div>
<div class="line">  - &#39;catch2@2.8:2&#39;</div>
<div class="line">  # Charm++:</div>
<div class="line">  # - The &#39;multicore&#39; backend runs with shared memory on a single node. On</div>
<div class="line">  #   clusters you should choose one of the multi-node backends instead.</div>
<div class="line">  - &#39;charmpp@7.0.0: backend=multicore&#39;</div>
<div class="line">  - &#39;cmake@3.18:&#39;</div>
<div class="line">  - doxygen</div>
<div class="line">  - gsl</div>
<div class="line">  - hdf5 -mpi</div>
<div class="line">  - jemalloc</div>
<div class="line">  - libsharp -mpi -openmp</div>
<div class="line">  - &#39;libxsmm@1.16.1:&#39;</div>
<div class="line">  - openblas</div>
<div class="line">  - &#39;python@3.7:&#39;</div>
<div class="line">  - &#39;py-pybind11@2.6:&#39;</div>
<div class="line">  - yaml-cpp@0.6.3</div>
<div class="line">  concretizer:</div>
<div class="line">    unify: true</div>
<div class="line">  view: true</div>
</div><!-- fragment --><p >You can also install the Spack packages listed in the environment file above with a plain <code>spack install</code> if you prefer.</p>
<p ><b>Notes:</b></p><ul>
<li>Spack allows very flexible configurations and we recommended you read the <a href="https://spack.readthedocs.io">documentation</a> if you require features such as packages installed with different compilers.</li>
<li>For security, it is good practice to make Spack <a href="https://spack.readthedocs.io/en/latest/getting_started.html#openssl">use the system's OpenSSL</a> rather than allow it to install a new copy.</li>
<li>To avoid reinstalling lots of system-provided packages with Spack, use the <code>spack external find</code> feature and the <code>--reuse</code> flag to <code>spack concretize</code> (or <code>spack install</code>). You can also install some of the dependencies with your system's package manager in advance, e.g., with <code>apt</code> or <code>brew</code>. If they are not picked up by <code>spack external find</code> automatically, register them with Spack manually. See the <a href="https://spack.readthedocs.io/en/latest/build_settings.html#external-packages">Spack documentation on external packages</a> for details.</li>
<li>Spack works well with a module environment, such as <a href="https://github.com/TACC/Lmod">LMod</a>. See the <a href="https://spack.readthedocs.io/en/latest/module_file_support.html">Spack documentation on modules</a> for details.</li>
<li>On macOS:<ul>
<li>Brigand has an issue with AppleClang 13 when compiling tests (see <a href="https://github.com/edouarda/brigand/issues/274">https://github.com/edouarda/brigand/issues/274</a>). Since it is header-only, you can simply clone the <a href="https://github.com/edouarda/brigand">Brigand repository</a> instead of installing it with Spack.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="building-charm"></a>
Building Charm++</h1>
<p >If you are not using a container, haven't installed Charm++ with Spack, or want to install Charm++ manually for other reasons, follow the installation instructions in the <a href="https://github.com/UIUC-PPL/charm">Charm++ repository</a> and in their <a href="https://charm.readthedocs.io/en/latest/quickstart.html#installing-charm">documentation</a>. Here are a few notes:</p>
<ul>
<li>Once you cloned the <a href="https://github.com/UIUC-PPL/charm">Charm++ repository</a>, run <code>git checkout v7.0.0</code> to switch to a supported, stable release of Charm++.</li>
<li>Apply the appropriate patch (if there is one) for the version from <code>${SPECTRE_ROOT}/support/Charm</code>. For example, if you have Charm++ v7.0.0 then the patch will be <code>v7.0.0.patch</code>.</li>
<li>Choose the <code>LIBS</code> target to compile. This is needed so that we can support the more sophisticated load balancers in SpECTRE executables.</li>
<li>On a personal machine the correct target architecture is likely <code>multicore-linux-x86_64</code>, or <code>multicore-darwin-x86_64</code> on macOS. On an HPC system the correct Charm++ target architecture depends on the machine's inter-node communication architecture. It might take some experimenting to figure out which Charm++ configuration provides the best performance.</li>
<li>Compile Charm++ with support for shared libraries by appending the option <code>--build-shared</code> to the <code>./build</code> command or pass <code>BUILD_SHARED=ON</code> to the CMake configuration (see the <a href="https://github.com/UIUC-PPL/charm#building-dynamic-libraries">Charm++ installation instructions</a>).</li>
<li>When compiling Charm++ you can specify the compiler using, for example, <div class="fragment"><div class="line">./build LIBS ARCH clang</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="building-spectre"></a>
Building SpECTRE</h1>
<p >Once you have set up your development environment you can compile SpECTRE. Follow these steps:</p>
<ol type="1">
<li>Create a build directory where you would like to compile SpECTRE. In the Docker container you could create, e.g., <code>/work/spectre-build</code>. It can be useful to add a descriptive label to the name of the build directory since you may create more later, e.g., <code>build-clang-Debug</code>. Then, <code>cd</code> into the build directory.</li>
<li>Determine the location of your Charm++ installation. In the Docker container it is <code>/work/charm_7_0_0/multicore-linux-x86_64-gcc</code> for GCC builds and <code>/work/charm_7_0_0/mpi-linux-x86_64-smp-clang</code> for clang builds. For Spack installations you can determine it with <code>spack location --install-dir charmpp</code>. We refer to the install directory as <code>CHARM_ROOT</code> below.</li>
<li>In your new SpECTRE build directory, configure the build with CMake: <div class="fragment"><div class="line">cmake -D CHARM_ROOT=$CHARM_ROOT SPECTRE_ROOT</div>
</div><!-- fragment --> Add options to the <code>cmake</code> command to to configure the build, select compilers, etc. For instance, to build with clang you may run: <div class="fragment"><div class="line">cmake -D CMAKE_CXX_COMPILER=clang++ \</div>
<div class="line">      -D CMAKE_C_COMPILER=clang \</div>
<div class="line">      -D CMAKE_Fortran_COMPILER=gfortran \</div>
<div class="line">      -D CHARM_ROOT=$CHARM_ROOT \</div>
<div class="line">      SPECTRE_ROOT</div>
</div><!-- fragment --> See <a class="el" href="spectre_build_system.html#common_cmake_flags">Commonly Used CMake flags</a> for documentation on possible configuration options.</li>
<li>When cmake configuration is done, you are ready to build target executables.<ul>
<li>You can see the list of available targets by running <code>make list</code> (or <code>ninja list</code> if you are using the Ninja generator) or by using tab completion. Compile targets with <code>make -jN TARGET</code> (or <code>ninja -jN TARGET</code>), where <code>N</code> is the number of cores to build on in parallel (e.g. <code>-j4</code>). Note that the Ninja generator allows you to compile individual source files too.</li>
<li>Compile the <code>unit-tests</code> target and run <code>ctest -L unit</code> to run unit tests. Compile <code>test-executables</code> and run <code>ctest</code> to run all tests, including executables. To compile <code>test-executables</code> you may have to reduce the number of cores you build on in parallel to avoid running out of memory.</li>
<li>To use the Python bindings (and CLI entry points), compile the <code>all-pybindings</code> (or <code>cli</code>) target (see <a class="el" href="spectre_using_python.html">Using SpECTRE's Python modules</a>).</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md8"></a>
Code Coverage Analysis</h1>
<p >For any coverage analysis you will need to have LCOV installed on the system. For documentation coverage analysis you will also need to install <a href="https://github.com/psycofdj/coverxygen">coverxygen</a> and for test coverage analysis <a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html">gcov</a>.</p>
<p >If you have these installed (which is already done if you are using the docker container), you can look at code coverage as follows:</p>
<ol type="1">
<li>On a gcc build, pass <code>-D COVERAGE=ON</code> to <code>cmake</code></li>
<li><code>make unit-test-coverage</code></li>
<li>The output is in <code>docs/html/unit-test-coverage</code>. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
