<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: Running and Visualizing</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('tutorial_visualization.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Running and Visualizing </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md63">Building an Executable from an Existing Source File</a></li>
<li class="level2"><a href="#autotoc_md64">Running an Evolution Executable</a></li>
<li class="level2"><a href="#autotoc_md65">3D Data Volume Data In ParaView</a></li>
<li class="level2"><a href="#autotoc_md66">Helpful ParaView Filters</a><ul><li class="level3"><a href="#autotoc_md67">Removing Mesh Imprinting</a></li>
<li class="level3"><a href="#autotoc_md68">Creating Derived Volume Data</a></li>
<li class="level3"><a href="#autotoc_md69">Visualizing Vector Fields Derived From Scalar Fields</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md70">Visualizing and Extracting Dat Files</a></li>
<li class="level2"><a href="#autotoc_md71">Reproducibility of Results</a></li>
</ul>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_Tutorials_Visualization"></a></p>
<h2><a class="anchor" id="autotoc_md63"></a>
Building an Executable from an Existing Source File</h2>
<p >SpECTRE source files for evolution executables are located in <code>src/Evolution/Executables</code>. Executables can be compiled by running the command <code>make EXECUTABLE_NAME</code> where <code>EXECUTABLE_NAME</code> is the name of the executable as defined in the <code>CMakeLists.txt</code> file located in the same directory as the source file. For example, to compile the executable that evolves a scalar wave using a three-dimensional domain, navigate to <code>$SPECTRE_HOME/build/</code>, then one runs the command: <code>make EvolveScalarWave3D</code>, which then results in an executable of the same name in the <code>bin</code> directory of the user's build directory.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Running an Evolution Executable</h2>
<p >Each SpECTRE executable reads a user-provided YAML file that specifies the runtime settings of the evolution. This is where options such as the <a class="el" href="classDomain.html" title="A wrapper around a vector of Blocks that represent the computational domain.">Domain</a>, AnalyticSolution, <a class="el" href="classTimeStepper.html" title="Abstract base class for TimeSteppers.">TimeStepper</a>, etc are supplied. Example input files are kept in <code>tests/InputFiles</code>, and are written to provide a functional base input file which the user can then modify as desired. Copy the executable and YAML file to a directory of your choice. The YAML file is then passed as an argument to the executable using the flag <code>--input-file</code>. For example, for a scalar wave evolution, run the command: <code>./EvolveScalarWave3D --input-file PlaneWave3D.yaml</code>. By default, the example input files do not produce any output. This can be changed by modifying the options passed to <code><a class="el" href="classEventsAndTriggers.html" title="Class that checks triggers and runs events.">EventsAndTriggers</a></code> or <code>EventsAndDenseTriggers</code>:</p>
<div class="fragment"><div class="line">EventsAndDenseTriggers:</div>
<div class="line">  - Trigger:</div>
<div class="line">      Times:</div>
<div class="line">        Specified:</div>
<div class="line">          Values: [0.0, 1.0]</div>
<div class="line">    Events:</div>
<div class="line">      - ObserveNorms:</div>
<div class="line">          SubfileName: Errors</div>
<div class="line">          TensorsToObserve:</div>
<div class="line">            - Name: Error(Psi)</div>
<div class="line">              NormType: L2Norm</div>
<div class="line">              Components: Sum</div>
<div class="line">            - Name: Error(Phi)</div>
<div class="line">              NormType: L2Norm</div>
<div class="line">              Components: Sum</div>
<div class="line">            - Name: Error(Pi)</div>
<div class="line">              NormType: L2Norm</div>
<div class="line">              Components: Sum</div>
<div class="line"> </div>
<div class="line">EventsAndTriggers:</div>
<div class="line">  - Trigger:</div>
<div class="line">      Slabs:</div>
<div class="line">        Specified:</div>
<div class="line">          Values: [100]</div>
<div class="line">    Events:</div>
<div class="line">      - Completion</div>
<div class="line">  - Trigger:</div>
<div class="line">      Slabs:</div>
<div class="line">        EvenlySpaced:</div>
<div class="line">          Interval: 50</div>
<div class="line">          Offset: 0</div>
<div class="line">    Events:</div>
<div class="line">      - ObserveFields:</div>
<div class="line">          SubfileName: VolumePsiPiPhiEvery50Slabs</div>
<div class="line">          VariablesToObserve: [&quot;Psi&quot;, &quot;Pi&quot;, &quot;Phi&quot;]</div>
<div class="line">          InterpolateToMesh: None</div>
<div class="line">          CoordinatesFloatingPointType: Double</div>
<div class="line">          FloatingPointTypes: [Double, Float, Float]</div>
<div class="line">          OverrideObservationValue: None</div>
</div><!-- fragment --><p >This will observe the norms of the errors in the system at times \(0.0\) and \(1.0\) and the field data at the start of every 50th slab. A successful observation will result in the creation of H5 files whose names can be specified in the YAML file under the options <code>VolumeFileName</code> and <code>ReductionFileName</code>. One volume data file will be produced from each Charm++ node that is used to run the executable. Each volume data file will have its corresponding node number appended to its file name. Visualization of the volume data will be described in the next section.</p>
<h2><a class="anchor" id="autotoc_md65"></a>
3D Data Volume Data In ParaView</h2>
<p >A SpECTRE executable with observers produces volume and/or reduced data <a class="el" href="namespaceh5.html" title="Contains functions and classes for manipulating HDF5 files.">h5</a> files. An XDMF file must be created from the volume data in order to do visualization using ParaView. To this end we provide the tool <code>generate-xdmf</code> in the Python command-line interface. Run it in your build directory as <code>spectre generate-xdmf</code>. It takes two required arguments which are passed to <code>--subfile-name</code>, and <code>--output</code>. The argument passed to <code>--subfile-name</code> is the name of the subfile inside the H5 volume data file where data is stored. In the above example, <code>--subfile-name</code> would be <code>VolumePsiPiPhiEvery50Slabs</code>. The argument passed to <code>--output</code> is the desired .xmf file name, also without filename extension. Use <code>--help</code> to see a further description of possible arguments.</p>
<p >Open the .xmf file in ParaView and select the <code>Xdmf Reader</code>, <em>not</em> the version 3 readers. On the left hand side of the main ParaView window is a section named <code>Properties</code>, here you must click the highlighted <code>Apply</code> button. ParaView will now render your volume data. If you only wish to visualize a few datasets out of a large set, we recommended unchecking the boxes for the datasets you wish to ignore under <code>Point Arrays</code> before clicking <code>Apply</code>. Also, don't forget to check which dataset is being used for the color under <code>Coloring</code>. The default won't necessarily be the dataset you want.</p>
<dl class="section note"><dt>Note</dt><dd>ParaView cannot understand <code>.xmf</code> files when subfile names have colons in them. Please avoid subfile names like <code>My::Subfile:Name</code>.</dd></dl>
<h2><a class="anchor" id="autotoc_md66"></a>
Helpful ParaView Filters</h2>
<p >Here we describe the usage of filters we've found to better visualize our data. Feel free to contribute to this section!</p>
<h3><a class="anchor" id="autotoc_md67"></a>
Removing Mesh Imprinting</h3>
<p >You may notice what appears to be mesh imprinting on the data. The imprinting effect can be removed by applying the <code>Tetrahedralize</code> filter. To apply the filter select the <code>Filters</code> menu item, then <code>Alphabetical</code> and finally <code>Tetrahedralize</code>.</p>
<h3><a class="anchor" id="autotoc_md68"></a>
Creating Derived Volume Data</h3>
<p >New volume data can be created from the existing volume data using the <code>Calculator</code> filter. In the <code>Calculator</code>'s text box, input a numerical expression in terms of existing datasets evaluating to the desired quantity. For example, a vector-valued velocity dataset can be created from three scalar velocity component datasets using the expression <code>velocity_x * iHat + velocity_y * jHat + velocity_z * kHat</code> and hitting the <code>Apply</code> button. By default, this will create a new dataset <code>Result</code>. The name of the new dataset can be changed by changing the name provided to <code>Result Array Name</code> above the <code>Calculator</code> text box.</p>
<h3><a class="anchor" id="autotoc_md69"></a>
Visualizing Vector Fields Derived From Scalar Fields</h3>
<p >Use the <code>Calculator</code> filter described above in "Creating Derived Volume Data" to create a new vector-valued dataset. Once this is created, use the <code>Glyph</code> filter and set the <code>Active Attributes</code> to the vector you wish to visualize. Make sure that <code>Scale Mode</code> is set to <code>vector</code>.</p>
<h2><a class="anchor" id="autotoc_md70"></a>
Visualizing and Extracting Dat Files</h2>
<p >Global quantities such as error norms are stored in <code><a class="el" href="classh5_1_1Dat.html" title="Represents a multicolumn dat file inside an HDF5 file.">h5::Dat</a></code> subfiles in the reduction/global HDF5 file. The command-line endpoint <code>spectre plot-dat</code> can be used to plot quantities, and <code>spectre extract-dat</code> can be used to extract them into space-separated text files. These text files can then be read with other plotting programs or viewed in an editor.</p>
<h2><a class="anchor" id="autotoc_md71"></a>
Reproducibility of Results</h2>
<p >Being able to reproduce the results of simulations is important for scientific integrity and accuracy. To this end, SpECTRE encodes the source tree, environment variables, and a record of build information (e.g., the third-party library versions) into the executables. From most executables these can be retrieved using the flags <code>--dump-source-as filename_without_extension</code>, <code>--dump-paths</code>, <code>--dump-build-info</code>, and <code>--dump-environment</code>. The flag <code>--dump-only</code> will cause the program to exit after the information has been dumped. You can use the <code>--help</code> flag to get more details on what flags are available. The flag <code>--dump-paths</code> will print to screen the environment variables <code>PATH</code>, <code>CPATH</code>, <code>LD_LIBRARY_PATH</code>, <code>LIBRARY_PATH</code>, and <code>CMAKE_PREFIX_PATH</code> at link time. The flag <code>--dump-build-info</code> will print to screen the contents of the <code>BuildInfo.txt</code> file generated by CMake. The flag <code>--dump-environment</code> will print to screen the output of <code>printenv</code> at link time. Finally, the flag <code>--dump-source-as filename_without_extension</code> will dump the archive <code>filename_without_extension.tar.gz</code>, which contains the entire source tree at link time. The combined above information should be enough to reproduce simulations results to roundoff error as long as the third party libraries used to build the executable have not changed on the system the simulation was run on.</p>
<p >Often only data from the simulation is retained, not the entire executable. In order to make simulations reproducible from only the HDF5 output, any HDF5 files written with SpECTRE's HDF5 wrappers contain the info about the run, output of <code>printenv</code> at link time, the contents of <code>BuildInfo.txt</code>, and an archive of the source tree. These are inside the <code>header.hdr</code> group with names <code>SimulationInfo</code>, <code>EnvironmentVariablesAtCompilation</code>, <code>BuildInfo</code>, and <code>src.tar.gz</code>. The source archive can be extracted by running the command </p><div class="fragment"><div class="line">h5dump -d /src.tar.gz -b LE -o src.tar.gz /path/to/hdf5/file.h5</div>
</div><!-- fragment --><p> You will need to make sure the argument to <code>-b</code> is the same endianness as your computer. In the above example little endian is used. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials.html">User Tutorials</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
