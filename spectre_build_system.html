<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: Build System</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
  <script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
  <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
  <script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
  </script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2023.06.19</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('spectre_build_system.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Build System </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#cmake">CMake</a><ul><li class="level2"><a href="#adding_source_files">Adding Source Files</a><ul><li class="level3"><a href="#adding_libraries">Adding Libraries</a></li>
</ul>
</li>
<li class="level2"><a href="#adding_unit_tests">Adding Unit Tests</a></li>
<li class="level2"><a href="#adding_executables">Adding Executables</a></li>
<li class="level2"><a href="#adding_external_dependencies">Adding External Dependencies</a></li>
<li class="level2"><a href="#common_cmake_flags">Commonly Used CMake flags</a></li>
<li class="level2"><a href="#autotoc_md83">CMake targets</a></li>
<li class="level2"><a href="#autotoc_md84">Checking Dependencies</a></li>
<li class="level2"><a href="#autotoc_md85">Formaline</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_DevGuide_BuildSystem"></a></p>
<h1><a class="anchor" id="cmake"></a>
CMake</h1>
<p >SpECTRE uses <a href="https://cmake.org/">CMake</a> for the build system. In this section of the guide we outline how to <a class="el" href="spectre_build_system.html#adding_source_files">add new source files</a>, <a class="el" href="spectre_build_system.html#adding_libraries">libraries</a>, <a class="el" href="spectre_build_system.html#adding_unit_tests">unit tests</a>, <a class="el" href="spectre_build_system.html#adding_executables">executables</a>, and <a class="el" href="spectre_build_system.html#adding_external_dependencies">external dependencies</a>. We also describe <a class="el" href="spectre_build_system.html#common_cmake_flags">commonly used CMake flags</a>.</p>
<p >Note that in editing <code>CMakeLists.txt</code> files, it is conventional to indent multiline commands by two spaces (except for the first line), and to separate most commands by blank lines.</p>
<h2><a class="anchor" id="adding_source_files"></a>
Adding Source Files</h2>
<p >SpECTRE organizes source files into subdirectories of <code>src</code> that are compiled into libraries. To add a new source file <code>FILE.cpp</code> to an existing library in <code>src/PATH/DIR</code>, just edit <code>src/PATH/DIR/CMakeLists.txt</code> and add <code>FILE.cpp</code> to the list of files in </p><div class="fragment"><div class="line">set(LIBRARY_SOURCES</div>
<div class="line">  &lt;list_of_files&gt;</div>
<div class="line">  )</div>
</div><!-- fragment --><p> such that the resulting <code>&lt;list_of_files&gt;</code> is in alphabetical order.</p>
<h3><a class="anchor" id="adding_libraries"></a>
Adding Libraries</h3>
<p >To add a source file <code>FILE.cpp</code> that is compiled into a new library <code>LIB</code> in a directory <code>src/PATH/DIR</code> (either in a new directory, or in an existing directory that either does not have a <code>CMakeLists.txt</code> file, or does not create a library in the existing <code>CMakeLists.txt</code>):</p><ul>
<li>Create (if necessary) a <code>CMakeLists.txt</code> file in <code>DIR</code>, with the following two lines at the top: <div class="fragment"><div class="line"># Distributed under the MIT License.</div>
<div class="line"># See LICENSE.txt for details.</div>
</div><!-- fragment --></li>
<li>In the parent directory (i.e. <code>src/PATH</code>), (if necessary) add the following line to its <code>CMakeLists.txt</code> file (if necessary, recursively do the previous step and this one until you reach a <code>CMakeLists.txt</code> that adds the appropriate subdirectory): <div class="fragment"><div class="line">add_subdirectory(DIR)</div>
</div><!-- fragment --> If there are already other <code>add_subdirectory()</code> lines in the file, place the new one so that the subdirectories are in alphabetical order.</li>
<li>Add the line: <div class="fragment"><div class="line">set(LIBRARY LIB)</div>
</div><!-- fragment --> where convention is that <code>LIB</code> = <code>DIR</code>. As library names must be unique, this is not always possible, in which case the convention is to prepend the parent directory to <code>DIR</code>.</li>
<li>Add the lines <div class="fragment"><div class="line">set(LIBRARY_SOURCES</div>
<div class="line">  FILE.cpp</div>
<div class="line">  )</div>
<div class="line"> </div>
<div class="line">add_spectre_library(${LIBRARY} ${LIBRARY_SOURCES})</div>
<div class="line"> </div>
<div class="line">target_link_libraries(</div>
<div class="line">  ${LIBRARY}</div>
<div class="line">  PUBLIC</div>
<div class="line">  &lt;list_of_public_libraries&gt;</div>
<div class="line">  PRIVATE</div>
<div class="line">  &lt;list_of_private_libraries&gt;</div>
<div class="line">  INTERFACE</div>
<div class="line">  &lt;list_of_interface_libraries&gt;</div>
<div class="line">  )</div>
</div><!-- fragment --> where each <code>&lt;list_of_X_libraries&gt;</code> is an alphabetized list of libraries of the form <div class="fragment"><div class="line">SomeLibrary</div>
<div class="line">SomeOtherLibrary</div>
<div class="line">YetAnotherLibrary</div>
</div><!-- fragment --> The libraries listed under <code>INTERFACE</code> are those included in at least one <code>.hpp</code> file in <code>LIB</code> but never used in any <code>.cpp</code> files in <code>LIB</code>. The libraries listed under <code>PRIVATE</code> are used in at least one <code>.cpp</code> file in <code>LIB</code> but not in any <code>.hpp</code> file in <code>LIB</code>. The libraries listed under <code>PUBLIC</code> are used in at least one <code>.hpp</code> file and at least one <code>.cpp</code> file in <code>LIB</code>. Note that a library counts as being used in a <code>.cpp</code> file if the corresponding <code>.hpp</code> file includes it. In other words, list a dependency as <code>PRIVATE</code> if it is needed only to compile the library, but not for including headers. List a dependency as <code>INTERFACE</code> if it is not needed to compile the library, but is needed for including headers. List a dependency as <code>PUBLIC</code> if it is needed for both.</li>
</ul>
<h2><a class="anchor" id="adding_unit_tests"></a>
Adding Unit Tests</h2>
<p >We use the <a href="https://github.com/philsquared/Catch">Catch</a> testing framework for unit tests. All unit tests are housed in <code>tests/Unit</code> with subdirectories for each subdirectory of <code>src</code>. Add the <code>cpp</code> file to the appropriate subdirectory and also to the <code>CMakeLists.txt</code> in that subdirectory. Inside the source file you can create a new test by adding a <code>SPECTRE_TEST_CASE("Unit.Dir.Component", "[Unit][Dir][Tag]")</code>. The <code>[Tag]</code> is optional and you can have more than one, but the tags should be used quite sparingly. The purpose of the tags is to be able to run all unit tests or all tests of a particular set of components, e.g. <code>ctest -L Data</code> to run all tests inside the <code>Data</code> directory. Please see <a class="el" href="writing_unit_tests.html">writing unit tests</a>, other unit tests and the <a href="https://github.com/philsquared/Catch">Catch documentation</a> for more help on writing tests. Unit tests should take as short a time as possible, with a goal of less than two seconds. Please also limit the number of distinct cases (by using <code>SECTION</code>s).</p>
<p >You can check the unit test coverage of your code by installing all the optional components and then running <code>make unit-test-coverage</code> (after re-running CMake). This will create the directory <code>BUILD_DIR/docs/html/unit-test-coverage/</code> which is where the coverage information is located. Open the <code>index.html</code> file in your browser and make sure that your tests are indeed checking all lines of your code. Your pull requests might not be merged until your line coverage is over 90% (we are aiming for 100% line coverage wherever possible). Unreachable lines of code can be excluded from coverage analysis by adding the inline comment <code>LCOV_EXCL_LINE</code> or a block can be excluded using <code>LCOV_EXCL_START</code> and <code>LCOV_EXCL_STOP</code>. However, this should be used extremely sparingly since unreachable code paths should be removed from the code base altogether.</p>
<h2><a class="anchor" id="adding_executables"></a>
Adding Executables</h2>
<p >All general executables are found in <code>src/Executables</code>, while those for specific evolution (elliptic) systems are found in <code>src/Evolution/Executables</code> (<code>src/Elliptic/Executables</code>). See <a class="el" href="dev_guide_creating_executables.html">how to create executables</a>.</p>
<h2><a class="anchor" id="adding_external_dependencies"></a>
Adding External Dependencies</h2>
<p >To add an external dependency, first add a <code>SetupDEPENDENCY.cmake</code> file to the <code>cmake</code> directory. You should model this after one of the existing ones for <code>Catch</code> or <code>Brigand</code> if you're adding a header-only library and <code>yaml-cpp</code> if the library is not header-only. If CMake does not already support <code>find_package</code> for the library you're adding you can write your own. These should be modeled after <code>FindBrigand</code> or <code>FindCatch</code> for header-only libraries, and <code>FindYAMLCPP</code> for compiled libraries. The <code>SetupDEPENDENCY.cmake</code> file must then be included in the root <code>spectre/CMakeLists.txt</code>. Be sure to test both that setting <code>LIBRARY_ROOT</code> works correctly for your library, and also that if the library is required that CMake fails gracefully if the library is not found.</p>
<h2><a class="anchor" id="common_cmake_flags"></a>
Commonly Used CMake flags</h2>
<p >The following are the most common flags used to control building with <code>CMake</code>. They are used by </p><div class="fragment"><div class="line">cmake -D FLAG1=OPT1 ... -D FLAGN=OPTN &lt;SPECTRE_ROOT&gt;</div>
</div><!-- fragment --><ul>
<li>ASAN<ul>
<li>Whether or not to turn on the address sanitizer compile flags (<code>-fsanitize=address</code>) (default is <code>OFF</code>)</li>
</ul>
</li>
<li>BLAZE_USE_ALWAYS_INLINE<ul>
<li>Force Blaze inlining (default is <code>ON</code>)</li>
<li>If disabled or if the platform is unable to 100% guarantee inlining, falls back to <code>BLAZE_USE_STRONG_INLINE</code> (see below)</li>
<li>Forced inlining reduces function call overhead, and so generally reduces runtime. However, it does increase compile time and compile memory usage. It is also easier to use a debugger when forced inlining is disabled. If you are encountering debugger messages like <code>function inlined</code>, then forced inlining should be disabled.</li>
</ul>
</li>
<li>BLAZE_USE_STRONG_INLINE<ul>
<li>Increase the likelihood of Blaze inlining (default is <code>ON</code>)</li>
<li>Strong inlining reduces function call overhead, and so generally reduces runtime. However, it does increase compile time and compile memory usage. It is also easier to use a debugger when strong inlining is disabled. If you are encountering debugger messages like <code>function inlined</code>, then strong inlining should be disabled.</li>
</ul>
</li>
<li>BOOTSTRAP_PY_DEPS and BOOTSTRAP_PY_DEV_DEPS<ul>
<li>Install missing Python dependencies into the build directory, as listed in <code>support/Python/requirements.txt</code> and <code>support/Python/dev_requirements.txt</code>, respectively. This is an alternative to creating a Python environment and installing the packages yourself. If you run into problems with packages like h5py, numpy or scipy you can/should still install them yourself to make sure they use the correct HDF5, BLAS, etc. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>BUILD_PYTHON_BINDINGS<ul>
<li>Build python libraries to call SpECTRE C++ code from python (default is <code>ON</code>)</li>
</ul>
</li>
<li>BUILD_SHARED_LIBS<ul>
<li>Whether shared libraries are built instead of static libraries (default is <code>OFF</code>)</li>
</ul>
</li>
<li>BUILD_TESTING<ul>
<li>Enable building tests. (default is <code>ON</code>)</li>
</ul>
</li>
<li>BUILD_DOCS<ul>
<li>Enable building documentation. (default is <code>ON</code>)</li>
</ul>
</li>
<li>DOCS_ONLY<ul>
<li>Build <em>only</em> documentation (default is <code>OFF</code>). Requires <code>BUILD_DOCS=ON</code>.</li>
</ul>
</li>
<li>CHARM_ROOT<ul>
<li>The path to the build directory of <code>Charm++</code></li>
</ul>
</li>
<li>CHARM_TRACE_PROJECTIONS<ul>
<li>Enables tracing with Charm++ projections. Specifically, enables the link flag <code>-tracemode projections</code>. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>CHARM_TRACE_SUMMARY<ul>
<li>Enables trace summaries with Charm++ projections. Specifically, enables the link flag <code>-tracemode summary</code>. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>CMAKE_BUILD_TYPE<ul>
<li>Sets the build type. Common options:<ul>
<li><code>Debug</code> (the default if the flag is not specified): sets flags that trigger additional error checking</li>
<li><code>Release</code></li>
</ul>
</li>
</ul>
</li>
<li>CMAKE_C_COMPILER<ul>
<li>The <code>C</code> compiler used (defaults to whatever is determined by <code>CMake/Modules/CMakeDetermineCCompiler.cmake</code>, usually <code>cc</code>)</li>
</ul>
</li>
<li>CMAKE_CXX_COMPILER<ul>
<li>The <code>C++</code> compiler used (defaults to whatever is determined by <code>CMake/Modules/CMakeDetermineCXXCompiler.cmake</code>, usually <code>c++</code>)</li>
</ul>
</li>
<li>CMAKE_Fortran_COMPILER<ul>
<li>The <code>Fortran</code> compiler used (defaults to whatever is determined by <code>CMake/Modules/CMakeDetermineFortranCompiler.cmake</code>)</li>
</ul>
</li>
<li>CMAKE_C_FLAGS<ul>
<li>Additional flags passed to the <code>C</code> compiler.</li>
</ul>
</li>
<li>CMAKE_CXX_FLAGS<ul>
<li>Additional flags passed to the <code>C++</code> compiler.</li>
</ul>
</li>
<li>CMAKE_Fortran_FLAGS<ul>
<li>Additional flags passed to the <code>Fortran</code> compiler.</li>
</ul>
</li>
<li>CMAKE_RUNTIME_OUTPUT_DIRECTORY<ul>
<li>Sets the directory where the library and executables are placed. By default libraries end up in <code>&lt;BUILD_DIR&gt;/lib</code> and executables in <code>&lt;BUILD_DIR&gt;/bin</code>.</li>
</ul>
</li>
<li>CMAKE_INSTALL_PREFIX<ul>
<li>Location where the <code>install</code> target copies executables, libraries, etc. Make sure to set this variable before you <code>install</code>, or a default location such as <code>/usr/local</code> is used.</li>
</ul>
</li>
<li>COVERAGE<ul>
<li>Enable code coverage with GCOV and LCOV (default <code>OFF</code>)</li>
</ul>
</li>
<li>DEBUG_SYMBOLS<ul>
<li>Whether or not to use debug symbols (default is <code>ON</code>)</li>
<li>Disabling debug symbols will reduce compile time and total size of the build directory.</li>
</ul>
</li>
<li>ENABLE_PROFILING<ul>
<li>Enables various options to make profiling SpECTRE easier (default is <code>OFF</code>)</li>
</ul>
</li>
<li>ENABLE_SPECTRE_DEBUG<ul>
<li>Defines <code>SPECTRE_DEBUG</code> macro to enable <code>ASSERT</code>s and other debug checks so they can be used in Release builds. That is, you get sanity checks and compiler optimizations. You cannot disable the checks in Debug builds, so this option has no effect in Debug builds. (default is <code>OFF</code> in release)</li>
</ul>
</li>
<li>ENABLE_WARNINGS<ul>
<li>Whether or not warning flags are enabled (default is <code>ON</code>)</li>
</ul>
</li>
<li>KEEP_FRAME_POINTER<ul>
<li>Whether to keep the frame pointer. Needed for profiling or other cases where you need to be able to figure out what the call stack is. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>MACHINE<ul>
<li>Select a machine that we know how to run on, such as a particular supercomputer. A file named MACHINE.yaml must exist in support/Machines and a submit script template named MACHINE.sh must exist in support/SubmitScripts.</li>
</ul>
</li>
<li>MEMORY_ALLOCATOR<ul>
<li>Set which memory allocator to use. If there are unexplained segfaults or other memory issues, it would be worth setting <code>MEMORY_ALLOCATOR=SYSTEM</code> to see if that resolves the issue. It could be the case that different third-party libraries accidentally end up using different allocators, which is undefined behavior and will result in complete chaos. (default is <code>JEMALLOC</code>)</li>
</ul>
</li>
<li>PY_DEV_MODE<ul>
<li>Enable development mode for the Python package, meaning that Python files are symlinked rather than copied to the build directory. Allows to edit and test Python code much easier, in particular when it uses compiled Python bindings, but doesn't replace CMake placeholders in the Python code such as the project version. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>SPEC_ROOT<ul>
<li>Set to a path to a SpEC installation (the SpEC repository root) to link in SpEC libraries. In particular, the SpEC::Exporter library is linked in and enables loading SpEC data into SpECTRE. See <a class="el" href="installation.html">Installation</a> for details.</li>
</ul>
</li>
<li>SPECTRE_TEST_RUNNER<ul>
<li>Run test executables through a wrapper. This might be <code>charmrun</code>, for example. (default is to not use one)</li>
</ul>
</li>
<li>SPECTRE_TEST_TIMEOUT_FACTOR (and specific overrides SPECTRE_X_TEST_TIMEOUT_FACTOR for X one of UNIT, STANDALONE, INPUT_FILE, or PYTHON)<ul>
<li>Multiply the timeout for the respective set of tests by this factor (default is <code>1</code>).</li>
<li>This is useful to run tests on slower machines.</li>
</ul>
</li>
<li>SPECTRE_USE_ALWAYS_INLINE<ul>
<li>Force SpECTRE inlining (default is <code>ON</code>)</li>
<li>Forced inlining reduces function call overhead, and so generally reduces runtime. However, it does increase compile time and compile memory usage. It is also easier to use a debugger when forced inlining is disabled. If you are encountering debugger messages like <code>function inlined</code>, then forced inlining should be disabled.</li>
</ul>
</li>
<li>STRIP_SYMBOLS<ul>
<li>Whether or not to strip all symbols (default is <code>OFF</code>)</li>
<li>If enabled strips all extraneous symbols from libraries and executables, further reducing the size of them.</li>
</ul>
</li>
<li>STUB_EXECUTABLE_OBJECT_FILES<ul>
<li>Replace object files from executables after linking with empty stubs (default is <code>OFF</code>)</li>
<li>This is useful for drastically reducing the build size in CI, but since the object files are replaced with empty stubs will generally cause linking problems if used during development.</li>
</ul>
</li>
<li>STUB_LIBRARY_OBJECT_FILES<ul>
<li>Replace object files from libraries after linking with empty stubs (default is <code>OFF</code>)</li>
<li>This is useful for drastically reducing the build size in CI, but since the object files are replaced with empty stubs will generally cause linking problems if used during development.</li>
</ul>
</li>
<li>UBSAN_INTEGER<ul>
<li>Whether or not to turn on the undefined behavior sanitizer <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html">unsigned integer overflow</a> flag (<code>-fsanitize=integer</code>) (default is <code>OFF</code>)</li>
</ul>
</li>
<li>UBSAN_UNDEFINED<ul>
<li>Whether or not to turn on the undefined behavior sanitizer <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html">undefined behavior</a> compile flags (<code>-fsanitize=undefined</code>) (default is <code>OFF</code>)</li>
</ul>
</li>
<li>UNIT_TESTS_IN_TEST_EXECUTABLES<ul>
<li>Whether to build the <code>unit-tests</code> target as part of the <code>test-executables</code> target. This is used to build only the non-unit tests in the CI build that doesn't use the PCH. (default is <code>ON</code>)</li>
</ul>
</li>
<li>USE_CCACHE<ul>
<li>Use ccache to cache build output so that rebuilding parts of the source tree is faster. The cache will use up space on disk, with the default being around 2-5GB. If you are performing a one time build to test something specific you should consider disabling ccache in order to avoid removing cached files that may be useful in other builds. (default is <code>ON</code>)</li>
</ul>
</li>
<li>USE_FORMALINE<ul>
<li>Write the source tree into HDF5 files written to disk in order to increase reproducibility of results. (default is <code>ON</code>)</li>
</ul>
</li>
<li>USE_GIT_HOOKS<ul>
<li>Use git hooks to perform some sanity checks so that small goofs are caught before they are committed. These checks are particularly useful because they also run automatically on <a class="el" href="github_actions_guide.html">CI</a> and must pass before pull requests are merged. (default is <code>ON</code>)</li>
</ul>
</li>
<li>USE_IWYU<ul>
<li>Enable <a href="https://github.com/include-what-you-use/include-what-you-use">include-what-you-use (IWYU)</a> tools. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>USE_LD<ul>
<li>Override the automatically chosen linker. The options are <code>ld</code>, <code>gold</code>, and <code>lld</code>. (default is <code>OFF</code>)</li>
</ul>
</li>
<li>USE_PCH<ul>
<li>Whether or not to use pre-compiled headers (default is <code>ON</code>)</li>
<li>This needs to be turned <code>OFF</code> in order to use <a href="https://github.com/include-what-you-use/include-what-you-use">include-what-you-use (IWYU)</a></li>
</ul>
</li>
<li>USE_SLEEF<ul>
<li>Whether to use <a href="https://github.com/shibatch/sleef">Sleef</a> with Blaze to vectorize addition math functions like <code>sin</code>, <code>cos</code>, and <code>exp</code>. (default is <code>OFF</code>)</li>
<li><dl class="section note"><dt>Note</dt><dd>Blaze isn't tested super thoroughly across different architectures so there's unfortunately no guarantee that Blaze+Sleef will work everywhere.</dd></dl>
</li>
</ul>
</li>
<li>USE_XSIMD<ul>
<li>Whether to use <a href="https://github.com/xtensor-stack/xsimd">xsimd</a> with Blaze to vectorize addition math functions like <code>sin</code>, <code>cos</code>, and <code>exp</code>. Defines the macro <code>SPECTRE_USE_XSIMD</code>, which can be check to enable manual vectorization where necessary. (default is <code>OFF</code>)</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md83"></a>
CMake targets</h2>
<p >In addition to individual simulation executables, the following targets are available to build with <code>make</code> or <code>ninja</code>:</p>
<ul>
<li>unit-tests<ul>
<li>Build unit tests, which you can run with <code>ctest -L unit</code>. Available if <code>BUILD_TESTING</code> is <code>ON</code> (the default).</li>
</ul>
</li>
<li>test-executables<ul>
<li>Build all tests, including executables, so you can run all tests with <code>ctest</code>. Available if <code>BUILD_TESTING</code> is <code>ON</code> (the default). To compile <code>test-executables</code> you may have to reduce the number of cores you build on in parallel to avoid running out of memory.</li>
</ul>
</li>
<li>all-pybindings<ul>
<li>Build Python bindings. See <a class="el" href="spectre_using_python.html">Using SpECTRE's Python modules</a> for details.</li>
</ul>
</li>
<li>cli<ul>
<li>Same as all-pybindings</li>
</ul>
</li>
<li>install<ul>
<li>Install targets that have been built to the <code>CMAKE_INSTALL_PREFIX</code>. Doesn't try to build anything else.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md84"></a>
Checking Dependencies</h2>
<p >Getting dependencies of libraries correct is quite difficult. SpECTRE offers the CMake function <code>check_spectre_libs_dependencies</code>, defined in <code>cmake/SpectreCheckDependencies.cmake</code>, to check the dependencies for all libraries in the <code>libs</code> target. Individual target dependencies can be checked using the <code>check_target_dependencies</code> CMake function defined in <code>cmake/SpectreCheckTargetDependencies.cmake</code>. Please see those functions in the source tree for more details on how to use them.</p>
<h2><a class="anchor" id="autotoc_md85"></a>
Formaline</h2>
<p >SpECTRE's implementation of Formaline is based on, but distinct in implementation from, the original design by <a href="https://github.com/hypercott/formaline">Erik Schnetter and Christian Ott</a>, which embeds an archive of the source tree into the executable. The original design creates a C/C++ file with a function that returns an array/vector of <code>char</code>s (a byte stream). However, this results in a very large source file (50MB or more), which is very slow to compile and ends up more than doubling the link time. Instead, SpECTRE's Formaline implementation uses the linker <code>ld</code> to encode a file into an object, which means rather than creating a large source file, we can directly encode the source tree archive into the binary at the linking stage.</p>
<p >Most of SpECTRE's Formaline is implemented inside the <code>tools/WrapExecutableLinker.sh</code> script. Function declarations are provided in <code>Utilities/Formaline.hpp</code> and a small function that writes the source file to disk is defined in <code>Utilities/Formaline.cpp</code>. The first Formaline-related thing done in <code>WrapExecutableLinker.sh</code> is to archive everything in the source directory tracked by git. Once the archive is created we run <code>ld -r -b binary -o object.o src.tar.gz</code> (with unique names for <code>object.o</code> and <code>src.tar.gz</code> for each executable that is built to avoid name collisions) to generate an object file with the source file encoded from <code>_binary_src_tar_gz_start</code> to <code>_binary_src_tar_gz_end</code>. Next we write a C++ source file that defines a function <code>get_archive</code> to convert the byte stream into a <code><a class="elRef" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector</a>&lt;char&gt;</code>. We also encode the output of <code>printenv</code>, the various <code>PATH</code> environment variables, and the CMake generated <code>BuildInfo.txt</code> file into the source file. Finally, the generated source file is built during the linking phase and the object file containing the source archive is linked into the executable.</p>
<p >To further aid in reproducibility, the <code>printenv</code> output and <code>BuildInfo.txt</code> contents are written to HDF5 files as part of the <code><a class="el" href="classh5_1_1Header.html" title="Writes header info about the build, git commit, branch, etc.">h5::Header</a></code> object. The archive of the source tree is written using the <code><a class="el" href="classh5_1_1SourceArchive.html" title="Writes an archive of the source tree into a dataset.">h5::SourceArchive</a></code> object and can be extracted by running </p><div class="fragment"><div class="line">h5dump -d /src.tar.gz -b LE -o src.tar.gz /path/to/hdf5/file.h5</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dev_guide.html">Developer Guides</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2023
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
